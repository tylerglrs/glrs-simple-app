const{createContext,useContext,useState,useRef}=React,AppContext=createContext(null),useAppContext=()=>{const e=useContext(AppContext);if(!e)throw new Error("useAppContext must be used within AppProvider");return e},AppProvider=({children:e,user:o})=>{const[t,l]=useState("home"),[r,a]=useState("life"),[d,g]=useState([]),[m,f]=useState(!1),[p,h]=useState(!0),[y,u]=useState(null),[s,i]=useState(null),[c,w]=useState(null),[S,k]=useState(0),[v,I]=useState(null),[A,G]=useState(!1),[x,E]=useState(0),[H,P]=useState(null),[B,L]=useState([]),[W,j]=useState(null),[N,F]=useState(null),[O,Q]=useState(!1),[U,J]=useState({morning:!1,evening:!1}),[Z,_]=useState(0),[q,V]=useState([]),[Y,$]=useState({checkIn:0,assignment:0}),[z,K]=useState(0),[X,ee]=useState(!1),[oe,te]=useState(null),[se,ne]=useState(null),[ae,le]=useState(!1),[re,ie]=useState([]),[ce,de]=useState(null),[ue,ge]=useState(null),[fe,pe]=useState(null),[he,ye]=useState(null),[we,Ce]=useState(0),[me,ke]=useState(!1),[Se,ve]=useState(0),[Me,Te]=useState(0),[Re,be]=useState(0),[De,Ie]=useState(!1),[Ae,Ge]=useState(0),[xe,Ee]=useState(0),[He,Pe]=useState(0),[Be,Le]=useState(null),[We,je]=useState(0),[Ne,Fe]=useState([]),[Oe,Qe]=useState(""),[Ue,Je]=useState(0),[Ze,_e]=useState([]),[qe,Ve]=useState([]),[Ye,$e]=useState([]),[ze,Ke]=useState(0),[Xe,eo]=useState(!1),[oo,to]=useState(0),[so,no]=useState(0),[ao,lo]=useState("mood"),[ro,io]=useState(0),[co,uo]=useState(0),[go,fo]=useState(0),[po,ho]=useState(0),[yo,wo]=useState(0),[Co,mo]=useState([]),[ko,So]=useState([]),[vo,Mo]=useState(!1),[To,Ro]=useState(0),[bo,Do]=useState(!1),[Io,Ao]=useState(!1),[Go,xo]=useState(!1),[Eo,Ho]=useState(!1),[Po,Bo]=useState(!1),[Lo,Wo]=useState(!1),[jo,No]=useState(!1),[Fo,Oo]=useState(!1),[Qo,Uo]=useState(!1),[Jo,Zo]=useState(!1),[_o,qo]=useState(!1),[Vo,Yo]=useState(!1),[$o,zo]=useState(!1),[Ko,Xo]=useState(!1),[et,ot]=useState(!1),[tt,st]=useState(!1),[nt,at]=useState(!1),[lt,rt]=useState(!1),[it,ct]=useState(!1),[dt,ut]=useState(!1),[gt,ft]=useState(!1),[pt,ht]=useState(!1),[yt,wt]=useState(!1),[Ct,mt]=useState(!1),[kt,St]=useState(!1),[vt,Mt]=useState(!1),[Tt,Rt]=useState(!1),[bt,Dt]=useState(!1),[It,At]=useState(!1),[Gt,xt]=useState(!1),[Et,Ht]=useState(!1),[Pt,Bt]=useState(!1),[Lt,Wt]=useState(!1),[jt,Nt]=useState(!1),[Ft,Ot]=useState(!1),[Qt,Ut]=useState(!1),[Jt,Zt]=useState(!1),[_t,qt]=useState([]),[Vt,Yt]=useState([]),[$t,zt]=useState([]),[Kt,Xt]=useState([]),[es,os]=useState(""),[ts,ss]=useState(""),[ns,as]=useState(""),[ls,rs]=useState(!1),[is,cs]=useState(!1),[ds,us]=useState(!1),[gs,fs]=useState("checkin"),[ps,hs]=useState({mood:null,craving:null,anxiety:null,sleep:null}),[ys,ws]=useState({overallDay:null,promptResponse:"",challenges:"",gratitude:"",tomorrowGoal:""}),[Cs,ms]=useState(null),[ks,Ss]=useState([]),[vs,Ms]=useState(null),[Ts,Rs]=useState("month"),[bs,Ds]=useState(new Date),[Is,As]=useState(new Date),[Gs,xs]=useState([]),[Es,Hs]=useState({longestStreak:0,currentStreak:0,allStreaks:[]}),[Ps,Bs]=useState({longestStreak:0,currentStreak:0,allStreaks:[]}),[Ls,Ws]=useState([]),[js,Ns]=useState([]),[Fs,Os]=useState(null),[Qs,Us]=useState("all"),[Js,Zs]=useState(""),[_s,qs]=useState(""),[Vs,Ys]=useState([]),[$s,zs]=useState(null),[Ks,Xs]=useState([]),[en,on]=useState(null),[tn,sn]=useState(null),[nn,an]=useState(""),[ln,rn]=useState(""),[cn,dn]=useState({start:null,end:null}),[un,gn]=useState("all"),[fn,pn]=useState(null),[hn,yn]=useState([]),[wn,Cn]=useState([]),[mn,kn]=useState(null),[Sn,vn]=useState(""),[Mn,Tn]=useState(""),[Rn,bn]=useState({completionRate:0,currentStreak:0,bestStreak:0,totalGoals:0}),[Dn,In]=useState({checkRate:0,avgMood:0,thisWeekCompletion:0}),[An,Gn]=useState([]),[xn,En]=useState(0),[Hn,Pn]=useState([]),[Bn,Ln]=useState([]),[Wn,jn]=useState({totalThisMonth:0,avgDailyScore:0,topGratitudeTheme:""}),[Nn,Fn]=useState([]),[On,Qn]=useState("main"),[Un,Jn]=useState([]),[Zn,_n]=useState([]),[qn,Vn]=useState([]),[Yn,$n]=useState([]),[zn,Kn]=useState([]),[Xn,ea]=useState(null),[oa,ta]=useState([]),[sa,na]=useState(""),[aa,la]=useState(null),[ra,ia]=useState(!1),[ca,da]=useState({videos:[],articles:[],tools:[],worksheets:[]}),[ua,ga]=useState([]),[fa,pa]=useState(0),[ha,ya]=useState(null),[wa,Ca]=useState(!1),[ma,ka]=useState(!1),[Sa,va]=useState(!1),[Ma,Ta]=useState(!1),[Ra,ba]=useState(()=>!localStorage.getItem("disclaimerAccepted")),[Da,Ia]=useState(!1),[Aa,Ga]=useState(0),[xa,Ea]=useState(!1),Ha=useRef(null),Pa=useRef(null),Ba=useRef(null),La=useRef(null),Wa=useRef(null),ja=useRef(null),Na=useRef(null),Fa=useRef(null),Oa=useRef(null),Qa=useRef(0),Ua=useRef(null),Ja=useRef([]),C=window.GLRSApp?.hooks?.useHandlers?window.GLRSApp.hooks.useHandlers():{},n=window.GLRSApp?.hooks?.useLoaders?window.GLRSApp.hooks.useLoaders():{},R=window.db,b=window.firebase,Za=async M=>{if(window.GLRSApp?.actions?.updateGoalProgress)return window.GLRSApp.actions.updateGoalProgress({goalId:M,user:o,db:R,firebase:b})},_a=async(M,D,T)=>window.GLRSApp?.utils?.uploadChatImage?window.GLRSApp.utils.uploadChatImage(M,D,T):null,qa=async(M,D)=>{if(!o||!R||!b)return!1;const T=prompt("Please describe why you are flagging this content:");if(!T)return!1;try{return await R.collection("flaggedContent").add({contentType:M,...D,flaggedBy:o.uid,flaggedByName:y?.displayName||y?.firstName||"PIR",reason:T,status:"pending",createdAt:b.firestore.FieldValue.serverTimestamp()}),alert("Thank you. This content has been flagged for review."),!0}catch{return alert("Failed to flag content"),!1}},Va={user:o,currentView:t,setCurrentView:l,journeyTab:r,setJourneyTab:a,dailyQuotes:d,setDailyQuotes:g,showProfileModal:m,setShowProfileModal:f,loading:p,setLoading:h,userData:y,setUserData:u,profileImage:s,setProfileImage:i,coachInfo:c,setCoachInfo:w,sobrietyDays:S,setSobrietyDays:k,selectedMood:v,setSelectedMood:I,pledgeMade:A,setPledgeMade:G,moneySaved:x,setMoneySaved:E,dailyQuote:H,setDailyQuote:P,milestones:B,setMilestones:L,nextMilestone:W,setNextMilestone:j,activeBroadcast:N,setActiveBroadcast:F,broadcastDismissed:O,setBroadcastDismissed:Q,checkInStatus:U,setCheckInStatus:J,checkInStreak:Z,setCheckInStreak:_,streakCheckIns:q,setStreakCheckIns:V,complianceRate:Y,setComplianceRate:$,totalCheckIns:z,setTotalCheckIns:K,googleConnected:X,setGoogleConnected:ee,googleToken:oe,setGoogleToken:te,googleTokenExpiry:se,setGoogleTokenExpiry:ne,syncingGoogle:ae,setSyncingGoogle:le,checkIns:re,setCheckIns:ie,moodChartData:ce,setMoodChartData:de,cravingChartData:ue,setCravingChartData:ge,anxietyChartData:fe,setAnxietyChartData:pe,sleepChartData:he,setSleepChartData:ye,chartRef:Ha,cravingChartRef:Pa,anxietyChartRef:Ba,sleepChartRef:La,lifeCardIndex:we,setLifeCardIndex:Ce,lifeIsDragging:me,setLifeIsDragging:ke,lifeTouchStart:Se,setLifeTouchStart:ve,lifeTouchEnd:Me,setLifeTouchEnd:Te,lifeCardsRef:Wa,financesCardIndex:Re,setFinancesCardIndex:be,financesIsDragging:De,setFinancesIsDragging:Ie,financesTouchStart:Ae,setFinancesTouchStart:Ge,financesTouchEnd:xe,setFinancesTouchEnd:Ee,financesCardsRef:ja,savingsCarouselIndex:He,setSavingsCarouselIndex:Pe,activeSavingsGoal:Be,setActiveSavingsGoal:Le,actualMoneySaved:We,setActualMoneySaved:je,customGoalItems:Ne,setCustomGoalItems:Fe,tempAmount:Oe,setTempAmount:Qe,savingsCarouselTouchStart:Ue,setSavingsCarouselTouchStart:Je,savingsCarouselRef:Na,savingsItems:Ze,setSavingsItems:_e,savingsGoals:qe,setSavingsGoals:Ve,moneyMapStops:Ye,setMoneyMapStops:$e,wellnessCardIndex:ze,setWellnessCardIndex:Ke,wellnessIsDragging:Xe,setWellnessIsDragging:eo,wellnessTouchStart:oo,setWellnessTouchStart:to,wellnessTouchEnd:so,setWellnessTouchEnd:no,wellnessCardsRef:Fa,expandedGraph:ao,setExpandedGraph:lo,missedMoodCheckIns:ro,setMissedMoodCheckIns:io,missedCravingCheckIns:co,setMissedCravingCheckIns:uo,missedAnxietyCheckIns:go,setMissedAnxietyCheckIns:fo,missedSleepCheckIns:po,setMissedSleepCheckIns:ho,missedOverallCheckIns:yo,setMissedOverallCheckIns:wo,goals:Co,setGoals:mo,assignments:ko,setAssignments:So,showSidebar:vo,setShowSidebar:Mo,dueToday:To,setDueToday:Ro,showIncompleteTasksModal:bo,setShowIncompleteTasksModal:Do,showHabitTrackerModal:Io,setShowHabitTrackerModal:Ao,showQuickReflectionModal:Go,setShowQuickReflectionModal:xo,showThisWeekTasksModal:Eo,setShowThisWeekTasksModal:Ho,showOverdueItemsModal:Po,setShowOverdueItemsModal:Bo,showMarkCompleteModal:Lo,setShowMarkCompleteModal:Wo,showProgressStatsModal:jo,setShowProgressStatsModal:No,showGoalProgressModal:Fo,setShowGoalProgressModal:Oo,showTodayWinsModal:Qo,setShowTodayWinsModal:Uo,showCopingTechniqueModal:Jo,setShowCopingTechniqueModal:Zo,showGratitudeModal:_o,setShowGratitudeModal:qo,showGratitudeThemesModal:Vo,setShowGratitudeThemesModal:Yo,showJourneyCalendarModal:$o,setShowJourneyCalendarModal:zo,showMilestoneModal:Ko,setShowMilestoneModal:Xo,showPastReflectionsModal:et,setShowPastReflectionsModal:ot,showReflectionStreakModal:tt,setShowReflectionStreakModal:st,showReflectionStreaksModal:nt,setShowReflectionStreaksModal:at,showStreakModal:lt,setShowStreakModal:rt,showStreaksModal:it,setShowStreaksModal:ct,showWeeklyReportModal:dt,setShowWeeklyReportModal:ut,showIntentionsModal:gt,setShowIntentionsModal:ft,showProgressSnapshotModal:pt,setShowProgressSnapshotModal:ht,showPastIntentionsModal:yt,setShowPastIntentionsModal:wt,showGraphSettingsModal:Ct,setShowGraphSettingsModal:mt,showCalendarHeatmapModal:kt,setShowCalendarHeatmapModal:St,showMoodInsightsModal:vt,setShowMoodInsightsModal:Mt,showOverallDayInsightsModal:Tt,setShowOverallDayInsightsModal:Rt,showGratitudeJournalModal:bt,setShowGratitudeJournalModal:Dt,showChallengesHistoryModal:It,setShowChallengesHistoryModal:At,showChallengeCheckInModal:Gt,setShowChallengeCheckInModal:xt,showBreakthroughModal:Et,setShowBreakthroughModal:Ht,showTomorrowGoalsModal:Pt,setShowTomorrowGoalsModal:Bt,showMoodPatternModal:Lt,setShowMoodPatternModal:Wt,showCravingPatternModal:jt,setShowCravingPatternModal:Nt,showAnxietyPatternModal:Ft,setShowAnxietyPatternModal:Ot,showSleepPatternModal:Qt,setShowSleepPatternModal:Ut,showTipsModal:Jt,setShowTipsModal:Zt,habits:_t,setHabits:qt,todayHabits:Vt,setTodayHabits:Yt,quickReflections:$t,setQuickReflections:zt,todayWins:Kt,setTodayWins:Xt,newHabitName:es,setNewHabitName:os,newReflection:ts,setNewReflection:ss,newWin:ns,setNewWin:as,showHabitHistory:ls,setShowHabitHistory:rs,showReflectionHistory:is,setShowReflectionHistory:cs,showWinsHistory:ds,setShowWinsHistory:us,activeTaskTab:gs,setActiveTaskTab:fs,morningCheckInData:ps,setMorningCheckInData:hs,eveningReflectionData:ys,setEveningReflectionData:ws,patternDetection:Cs,setPatternDetection:ms,calendarHeatmapData:ks,setCalendarHeatmapData:Ss,selectedCalendarDay:vs,setSelectedCalendarDay:Ms,calendarViewMode:Ts,setCalendarViewMode:Rs,calendarCurrentMonth:bs,setCalendarCurrentMonth:Ds,calendarCurrentWeek:Is,setCalendarCurrentWeek:As,moodWeekData:Gs,setMoodWeekData:xs,streakData:Es,setStreakData:Hs,reflectionStreakData:Ps,setReflectionStreakData:Bs,overallDayWeekData:Ls,setOverallDayWeekData:Ws,allMilestones:js,setAllMilestones:Ns,selectedReflection:Fs,setSelectedReflection:Os,reflectionFilter:Qs,setReflectionFilter:Us,gratitudeTheme:Js,setGratitudeTheme:Zs,gratitudeText:_s,setGratitudeText:qs,gratitudeJournalData:Vs,setGratitudeJournalData:Ys,gratitudeInsights:$s,setGratitudeInsights:zs,challengesHistoryData:Ks,setChallengesHistoryData:Xs,challengesInsights:en,setChallengesInsights:on,selectedChallenge:tn,setSelectedChallenge:sn,challengeCheckInStatus:nn,setChallengeCheckInStatus:an,challengeCheckInNotes:ln,setChallengeCheckInNotes:rn,graphDateRange:cn,setGraphDateRange:dn,selectedRange:un,setSelectedRange:gn,breakthroughData:fn,setBreakthroughData:pn,tomorrowGoalsData:hn,setTomorrowGoalsData:yn,goalHistory:wn,setGoalHistory:Cn,yesterdayGoal:mn,setYesterdayGoal:kn,goalStatus:Sn,setGoalStatus:vn,goalNotes:Mn,setGoalNotes:Tn,goalStats:Rn,setGoalStats:bn,weeklyStats:Dn,setWeeklyStats:In,checkInData:An,setCheckInData:Gn,reflectionStreak:xn,setReflectionStreak:En,streakReflections:Hn,setStreakReflections:Pn,reflectionData:Bn,setReflectionData:Ln,reflectionStats:Wn,setReflectionStats:jn,coachNotes:Nn,setCoachNotes:Fn,activeChat:On,setActiveChat:Qn,communityMessages:Un,setCommunityMessages:Jn,topicRooms:Zn,setTopicRooms:_n,meetings:qn,setMeetings:Vn,supportGroups:Yn,setSupportGroups:$n,emergencyResources:zn,setEmergencyResources:Kn,activeTopicRoom:Xn,setActiveTopicRoom:ea,topicRoomMessages:oa,setTopicRoomMessages:ta,topicMessage:sa,setTopicMessage:na,selectedImage:aa,setSelectedImage:la,uploading:ra,setUploading:ia,resources:ca,setResources:da,notifications:ua,setNotifications:ga,unreadCount:fa,setUnreadCount:pa,showModal:ha,setShowModal:ya,fileInputRef:Oa,showTermsModal:wa,setShowTermsModal:Ca,showPrivacyModal:ma,setShowPrivacyModal:ka,showDataHandlingModal:Sa,setShowDataHandlingModal:va,showCrisisModal:Ma,setShowCrisisModal:Ta,showDisclaimerModal:Ra,setShowDisclaimerModal:ba,pulling:Da,setPulling:Ia,pullDistance:Aa,setPullDistance:Ga,refreshing:xa,setRefreshing:Ea,pullStartY:Qa,contentRef:Ua,listenersRef:Ja,handlePledge:C.handlePledge,handleMorningCheckIn:C.handleMorningCheckIn,handleEveningReflection:C.handleEveningReflection,handleAssignmentComplete:C.handleAssignmentComplete,handleReflectionSave:C.handleReflectionSave,saveGratitude:C.saveGratitude,handleProfileImageUpload:C.handleProfileImageUpload,handleTopicImageSelect:C.handleTopicImageSelect,handleSendMessage:C.handleSendMessage,handleFlagTopicMessage:C.handleFlagTopicMessage,loadAllData:n.loadAllData,loadUserData:n.loadUserData,loadTopicRooms:n.loadTopicRooms,loadMeetings:n.loadMeetings,loadGoals:n.loadGoals,loadAssignments:n.loadAssignments,loadHabits:n.loadHabits,loadTodayHabits:n.loadTodayHabits,loadQuickReflections:n.loadQuickReflections,loadTodayWins:n.loadTodayWins,loadDailyTasksStatus:n.loadDailyTasksStatus,loadDailyInspiration:n.loadDailyInspiration,loadMilestones:n.loadMilestones,loadBroadcasts:n.loadBroadcasts,loadResources:n.loadResources,loadCheckIns:n.loadCheckIns,loadStreakCheckIns:n.loadStreakCheckIns,loadTodaysPledge:n.loadTodaysPledge,loadStreak:n.loadStreak,loadCoachNotes:n.loadCoachNotes,loadCalendarHeatmapData:n.loadCalendarHeatmapData,loadMoodWeekData:n.loadMoodWeekData,loadOverallDayWeekData:n.loadOverallDayWeekData,loadGratitudeJournal:n.loadGratitudeJournal,loadGratitudeInsights:n.loadGratitudeInsights,loadDailyQuotes:n.loadDailyQuotes,loadChallengesHistory:n.loadChallengesHistory,loadTomorrowGoals:n.loadTomorrowGoals,loadGoalAchievementData:n.loadGoalAchievementData,loadReflections:n.loadReflections,loadStreakReflections:n.loadStreakReflections,loadChallengesInsights:n.loadChallengesInsights,loadComplianceRates:n.loadComplianceRates,loadSupportGroups:n.loadSupportGroups,loadEmergencyResources:n.loadEmergencyResources,updateStreak:n.updateStreak,updateGoalProgress:Za,uploadChatImage:_a,flagContent:qa};return React.createElement(AppContext.Provider,{value:Va},e)};window.GLRSApp=window.GLRSApp||{components:{},hooks:{}},window.GLRSApp.components.AppContext=AppContext,window.GLRSApp.components.AppProvider=AppProvider,window.GLRSApp.hooks.useAppContext=useAppContext,console.log("\u2705 AppContext.js loaded - Context API ready");const usePullToRefresh=({contentRef:e,pullStartY:o,currentView:t,setPulling:l,setPullDistance:r,setRefreshing:a,loadAllData:d,loadCheckIns:g,loadGoals:m,loadAssignments:f,loadCommunityMessages:p,loadTopicRooms:h,loadResources:y})=>{const u=async()=>{a(!0);try{navigator.vibrate&&navigator.vibrate(50),t==="home"?await d():t==="progress"?await g():t==="tasks"?(await m(),await f()):t==="connect"?(await p(),await h()):t==="profile"&&await y(),window.GLRSApp.utils.showNotification("Refreshed","success")}catch{window.GLRSApp.utils.showNotification("Refresh failed","error")}finally{a(!1),r(0),l(!1)}};return{handleRefresh:u,handleTouchStart:w=>{if(!e.current)return;e.current.scrollTop===0&&(o.current=w.touches[0].clientY)},handleTouchMove:w=>{if(!e.current||o.current===0)return;if(e.current.scrollTop>0){l(!1),r(0);return}const v=w.touches[0].clientY-o.current;v>0&&v<=120&&(l(!0),r(v),w.preventDefault())},handleTouchEnd:()=>{pulling&&pullDistance>80?u():(l(!1),r(0)),o.current=0}}},useDataLoading=(e,o,t,l,r,a)=>{React.useEffect(()=>(e&&(window.GLRSApp.loaders.loadAllData(),window.GLRSApp.listeners.setupRealtimeListeners(o,e,t,l,{setNotifications:r.setNotifications,setUnreadCount:r.setUnreadCount,setCommunityMessages:r.setCommunityMessages,setActiveBroadcast:r.setActiveBroadcast},{loadGoals:a.loadGoals,loadAssignments:a.loadAssignments,loadHabits:a.loadHabits,loadTodayHabits:a.loadTodayHabits,loadQuickReflections:a.loadQuickReflections,loadTodayWins:a.loadTodayWins}),a.loadGoogleConnection()),()=>{t.current.forEach(d=>d())}),[e])},useLucideIcons=e=>{React.useEffect(()=>{typeof lucide<"u"&&setTimeout(()=>{lucide.createIcons()},100)},e)},useSobrietyCalculation=(e,o,t)=>{React.useEffect(()=>{if(e?.sobrietyDate){const l=()=>{const a=window.GLRSApp.utils.calculateSobrietyDays(e.sobrietyDate);o(a);const d=e.dailyCost||20;t(a*d)};l();const r=setInterval(l,6e4);return()=>clearInterval(r)}},[e])},useModalIcons=e=>{React.useEffect(()=>{const o=setTimeout(()=>{window.lucide&&window.lucide.createIcons()},100);return()=>clearTimeout(o)},[e])},useJourneyTabIcons=(e,o)=>{React.useEffect(()=>{if(e==="journey"){const t=setTimeout(()=>{window.lucide&&window.lucide.createIcons()},150);return()=>clearTimeout(t)}},[e,o])},useSavingsData=(e,o,t,l,r,a,d,g)=>{React.useEffect(()=>{if(!e)return;(async()=>{try{const f=await o.collection("savingsItems").orderBy("minCost","asc").get();if(!f.empty){const u=f.docs.map(s=>({id:s.id,...s.data()}));t(u)}const p=await o.collection("savingsGoals").orderBy("amount","asc").get();if(!p.empty){const u=p.docs.map(s=>({id:s.id,...s.data()}));l(u)}const h=await o.collection("moneyMapStops").orderBy("amount","asc").get();if(!h.empty){const u=h.docs.map(s=>({id:s.id,...s.data()}));r(u)}const y=await o.collection("users").doc(e.uid).collection("savingsPreferences").doc("current").get();if(y.exists){const u=y.data();u.activeSavingsGoal&&a(u.activeSavingsGoal),u.actualMoneySaved&&d(u.actualMoneySaved),u.customGoalItems&&g(u.customGoalItems)}}catch(f){console.error("Error loading savings data:",f)}})()},[e])},useSavingsPreferences=(e,o,t,l,r)=>{React.useEffect(()=>{if(!e)return;const d=setTimeout(async()=>{try{await o.collection("users").doc(e.uid).collection("savingsPreferences").doc("current").set({activeSavingsGoal:t,actualMoneySaved:l,customGoalItems:r,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}catch(g){console.error("Error saving savings preferences:",g)}},1e3);return()=>clearTimeout(d)},[t,l,r,e])},useProgressCharts=(e,o,t,l,r)=>{React.useEffect(()=>{e==="progress"&&o&&t&&setTimeout(()=>{const a=document.getElementById("moodChart"),d=document.getElementById("cravingCanvas");if(l.current&&l.current.destroy(),r.current&&r.current.destroy(),a){const g=a.getContext("2d");l.current=new Chart(g,{type:"line",data:o,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:10}}}})}if(d){const g=d.getContext("2d");r.current=new Chart(g,{type:"line",data:t,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:10}}}})}},100)},[e,o,t])},useJourneyWellnessGraphs=(e,o,t,l)=>{React.useEffect(()=>{e==="progress"&&o==="wellness"&&t&&l.length>0&&setTimeout(()=>{const r=new Date,a=[];for(let s=30;s>=0;s--){const i=new Date(r);i.setDate(i.getDate()-s),a.push(i)}const d=a.map(s=>s.toLocaleDateString("en-US",{month:"short",day:"numeric"})),g=s=>l.find(i=>(i.createdAt?.toDate?i.createdAt.toDate():new Date(i.createdAt)).toDateString()===s.toDateString()),m=a.map(s=>g(s)?.morningData?.mood??null),f=a.map(s=>g(s)?.morningData?.craving??null),p=a.map(s=>g(s)?.morningData?.anxiety??null),h=a.map(s=>g(s)?.eveningData?.sleepQuality??null),y=a.map(s=>g(s)?.eveningData?.overallDay??null);if(t==="mood"){const s=document.getElementById("journeyMoodChart");if(s){const i=s.getContext("2d");window.journeyMoodChart&&typeof window.journeyMoodChart.destroy=="function"&&window.journeyMoodChart.destroy(),window.journeyMoodChart=new Chart(i,{type:"line",data:{labels:d,datasets:[{label:"Mood",data:m,borderColor:"#058585",backgroundColor:"rgba(5, 133, 133, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:"#058585",pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:"#058585",pointHoverBorderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"#058585",borderWidth:1,callbacks:{label:function(c){return c.parsed.y===null?"Missing check-in creates gaps in your wellness picture. Stay consistent to track your progress!":"Mood: "+c.parsed.y}}}},interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,max:10,ticks:{color:"#666"}},x:{ticks:{color:"#666"}}}}})}}else if(t==="cravings"){const s=document.getElementById("journeyCravingsChart");if(s){const i=s.getContext("2d");window.journeyCravingsChart&&typeof window.journeyCravingsChart.destroy=="function"&&window.journeyCravingsChart.destroy(),window.journeyCravingsChart=new Chart(i,{type:"line",data:{labels:d,datasets:[{label:"Cravings Intensity",data:f,borderColor:"#DC143C",backgroundColor:"rgba(220, 20, 60, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:"#DC143C",pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:"#DC143C",pointHoverBorderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"#DC143C",borderWidth:1,callbacks:{label:function(c){return c.parsed.y===null?"Missing check-in creates gaps in your wellness picture. Stay consistent to track your progress!":"Cravings: "+c.parsed.y}}}},interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,max:10,ticks:{color:"#666"}},x:{ticks:{color:"#666"}}}}})}}else if(t==="anxiety"){const s=document.getElementById("journeyAnxietyChart");if(s){const i=s.getContext("2d");window.journeyAnxietyChart&&typeof window.journeyAnxietyChart.destroy=="function"&&window.journeyAnxietyChart.destroy(),window.journeyAnxietyChart=new Chart(i,{type:"line",data:{labels:d,datasets:[{label:"Anxiety Level",data:p,borderColor:"#FFA500",backgroundColor:"rgba(255, 165, 0, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:"#FFA500",pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:"#FFA500",pointHoverBorderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"#FFA500",borderWidth:1,callbacks:{label:function(c){return c.parsed.y===null?"Missing check-in creates gaps in your wellness picture. Stay consistent to track your progress!":"Anxiety: "+c.parsed.y}}}},interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,max:10,ticks:{color:"#666"}},x:{ticks:{color:"#666"}}}}})}}else if(t==="sleep"){const s=document.getElementById("journeySleepChart");if(s){const i=s.getContext("2d");window.journeySleepChart&&typeof window.journeySleepChart.destroy=="function"&&window.journeySleepChart.destroy(),window.journeySleepChart=new Chart(i,{type:"line",data:{labels:d,datasets:[{label:"Sleep Quality",data:h,borderColor:"#9c27b0",backgroundColor:"rgba(156, 39, 176, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:"#9c27b0",pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:"#9c27b0",pointHoverBorderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"#9c27b0",borderWidth:1,callbacks:{label:function(c){return c.parsed.y===null?"Missing check-in creates gaps in your wellness picture. Stay consistent to track your progress!":"Sleep Quality: "+c.parsed.y}}}},interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,max:10,ticks:{color:"#666"}},x:{ticks:{color:"#666"}}}}})}}else if(t==="overall"){const s=document.getElementById("journeyOverallChart");if(s){const i=s.getContext("2d");window.journeyOverallChart&&typeof window.journeyOverallChart.destroy=="function"&&window.journeyOverallChart.destroy(),window.journeyOverallChart=new Chart(i,{type:"line",data:{labels:d,datasets:[{label:"Overall Day Rating",data:y,borderColor:"#4A90E2",backgroundColor:"rgba(74, 144, 226, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:"#4A90E2",pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:"#4A90E2",pointHoverBorderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"#4A90E2",borderWidth:1,callbacks:{label:function(c){return c.parsed.y===null?"Missing check-in creates gaps in your wellness picture. Stay consistent to track your progress!":"Overall Day Rating: "+c.parsed.y}}}},interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,max:10,ticks:{color:"#666"}},x:{ticks:{color:"#666"}}}}})}}const u=(s,i,c)=>{const w=document.getElementById(s);if(w){const S=w.getContext("2d"),k=s.replace("journey","").replace("Sparkline","");window[`journey${k}SparklineChart`]&&window[`journey${k}SparklineChart`].destroy(),window[`journey${k}SparklineChart`]=new Chart(S,{type:"line",data:{labels:d,datasets:[{data:i,borderColor:c,borderWidth:2,backgroundColor:`${c}1a`,tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:c,pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:c,pointHoverBorderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:c,borderWidth:1}},interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,max:10,ticks:{color:"#666"}},x:{ticks:{color:"#666"}}}}})}};t!=="mood"&&u("journeyMoodSparkline",m,"#058585"),t!=="cravings"&&u("journeyCravingsSparkline",f,"#DC143C"),t!=="anxiety"&&u("journeyAnxietySparkline",p,"#FFA500"),t!=="sleep"&&u("journeySleepSparkline",h,"#9c27b0"),t!=="overall"&&u("journeyOverallSparkline",y,"#4A90E2"),typeof lucide<"u"&&lucide.createIcons&&lucide.createIcons()},100)},[e,o,t,l])},useProfileCompletion=(e,o,t,l,r)=>{React.useEffect(()=>{e&&!e.profileComplete&&(e.firstName&&e.lastName&&e.phone?l.collection("users").doc(r.uid).update({profileComplete:!0}):o||setTimeout(()=>{localStorage.getItem("profilePromptShown")||(t("profilePrompt"),localStorage.setItem("profilePromptShown","true"))},5e3))},[e,o])},useMidnightReset=(e,o)=>{React.useEffect(()=>{(()=>{const l=new Date,r=e.timezone||"America/Los_Angeles",a=new Date(l.toLocaleString("en-US",{timeZone:r})),d=a.getHours(),g=a.getMinutes(),m=a.getSeconds(),f=((23-d)*60*60+(59-g)*60+(60-m))*1e3,p=setTimeout(()=>{window.GLRSApp.loaders.loadDailyTasksStatus(),window.GLRSApp.loaders.loadCheckIns(),o({morning:!1,evening:!1});const h=setInterval(()=>{window.GLRSApp.loaders.loadDailyTasksStatus(),window.GLRSApp.loaders.loadCheckIns(),o({morning:!1,evening:!1})},1440*60*1e3);return()=>clearInterval(h)},f);return()=>clearTimeout(p)})()},[])},usePatternDetection=(e,o)=>{React.useEffect(()=>{if(e.length>0){const t=window.GLRSApp.shared.patternDetection.detectPatterns(e);o(t)}},[e])};window.GLRSApp=window.GLRSApp||{hooks:{}},window.GLRSApp.hooks={usePullToRefresh,useDataLoading,useLucideIcons,useSobrietyCalculation,useModalIcons,useJourneyTabIcons,useSavingsData,useSavingsPreferences,useProgressCharts,useJourneyWellnessGraphs,useProfileCompletion,useMidnightReset,usePatternDetection},console.log("\u2705 App initialization hooks loaded");const loadGoogleConnection=async()=>{try{const o=(await db.collection("users").doc(user.uid).get()).data();if(o?.googleConnected&&o?.googleAccessToken){setGoogleConnected(!0);const t=window.GLRSApp.utils.decryptToken(o.googleAccessToken,user.uid);setGoogleToken(t),setGoogleTokenExpiry(o.googleTokenExpiry),o.googleTokenExpiry&&Date.now()>o.googleTokenExpiry}else setGoogleConnected(!1),setGoogleToken(null)}catch{setGoogleConnected(!1)}},checkGoogleToken=async()=>{try{if(!googleConnected||!googleToken)return{valid:!1,error:"Google Calendar not connected. Please connect in Settings."};const e=300*1e3;return googleTokenExpiry&&Date.now()+e>googleTokenExpiry?(window.GLRSApp.utils.showNotification("Refreshing Google Calendar connection...","info"),await refreshGoogleToken()?{valid:!0,token:googleToken}:(window.GLRSApp.utils.showNotification("Google Calendar connection expired. Please reconnect in Settings.","error"),{valid:!1,error:"Token refresh failed. Please reconnect Google Calendar."})):{valid:!0,token:googleToken}}catch(e){return window.GLRSApp.utils.showNotification("Error validating Google Calendar connection","error"),{valid:!1,error:"Failed to validate token: "+e.message}}},refreshGoogleToken=async()=>{try{return typeof google<"u"&&google.accounts,!1}catch{return!1}},connectGoogleCalendar=async()=>{setSyncingGoogle(!0);try{if(typeof google>"u"||!google.accounts)throw new Error("Google Identity Services not loaded. Please refresh the page.");google.accounts.oauth2.initTokenClient({client_id:"457406864879-k1sunucuqofe22m5rg93hvo6nngiqh0u.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/calendar.events",callback:async o=>{try{if(o.error)throw new Error(o.error);if(!o.access_token)throw new Error("No access token received");const t=window.GLRSApp.utils.encryptToken(o.access_token,user.uid);await db.collection("users").doc(user.uid).update({googleConnected:!0,googleAccessToken:t,googleTokenExpiry:Date.now()+o.expires_in*1e3,googleConnectedAt:firebase.firestore.FieldValue.serverTimestamp(),calendarSyncEnabled:!1}),setGoogleConnected(!0),setGoogleToken(o.access_token),setGoogleTokenExpiry(Date.now()+o.expires_in*1e3),window.GLRSApp.utils.showNotification("Google Calendar Connected!","success"),setShowModal(null),setTimeout(()=>loadGoogleConnection(),500)}catch(t){window.GLRSApp.utils.showNotification("Failed to save connection: "+t.message,"error")}finally{setSyncingGoogle(!1)}}}).requestAccessToken({prompt:"consent"})}catch(e){window.GLRSApp.utils.showNotification("Failed to connect: "+e.message,"error"),setSyncingGoogle(!1)}},disconnectGoogleCalendar=async()=>{if(confirm(`Disconnect Google Calendar?

This will remove:
\u2022 Calendar sync
\u2022 All synced milestones

You can reconnect anytime.`)){setSyncingGoogle(!0);try{googleToken&&typeof google<"u"&&google.accounts&&google.accounts.oauth2.revoke(googleToken,()=>{}),await db.collection("users").doc(user.uid).update({googleConnected:!1,googleAccessToken:firebase.firestore.FieldValue.delete(),googleTokenExpiry:firebase.firestore.FieldValue.delete(),calendarSyncEnabled:!1,milestoneCalendarEvents:firebase.firestore.FieldValue.delete(),googleDisconnectedAt:firebase.firestore.FieldValue.serverTimestamp()}),setGoogleConnected(!1),setGoogleToken(null),setGoogleTokenExpiry(null),window.GLRSApp.utils.showNotification("Google Calendar disconnected","success"),setShowModal(null)}catch(e){window.GLRSApp.utils.showNotification("Failed to disconnect: "+e.message,"error")}finally{setSyncingGoogle(!1)}}};
