const createLifeTouchHandlers=(n,o,e,i,a,l,u)=>({handleLifeTouchStart:t=>{i(t.targetTouches[0].clientX),l(!0)},handleLifeTouchMove:t=>{a(t.targetTouches[0].clientX)},handleLifeTouchEnd:()=>{if(!n||!o)return;const t=n-o,s=50;t>s&&e<2?(u(e+1),typeof window.GLRSApp?.utils?.triggerHaptic=="function"&&window.GLRSApp.utils.triggerHaptic("light")):t<-s&&e>0&&(u(e-1),typeof window.GLRSApp?.utils?.triggerHaptic=="function"&&window.GLRSApp.utils.triggerHaptic("light")),l(!1),i(0),a(0)}}),createFinancesTouchHandlers=(n,o,e,i,a,l,u)=>({handleFinancesTouchStart:t=>{i(t.targetTouches[0].clientX),l(!0)},handleFinancesTouchMove:t=>{a(t.targetTouches[0].clientX)},handleFinancesTouchEnd:()=>{if(!n||!o)return;const t=n-o,s=50;t>s&&e<2?(u(e+1),typeof window.GLRSApp?.utils?.triggerHaptic=="function"&&window.GLRSApp.utils.triggerHaptic("light")):t<-s&&e>0&&(u(e-1),typeof window.GLRSApp?.utils?.triggerHaptic=="function"&&window.GLRSApp.utils.triggerHaptic("light")),l(!1),i(0),a(0)}}),createWellnessTouchHandlers=(n,o,e,i,a,l,u)=>({handleWellnessTouchStart:t=>{i(t.targetTouches[0].clientX),l(!0)},handleWellnessTouchMove:t=>{a(t.targetTouches[0].clientX)},handleWellnessTouchEnd:()=>{if(!n||!o)return;const t=n-o,s=50;t>s&&e<2?(u(e+1),typeof window.GLRSApp?.utils?.triggerHaptic=="function"&&window.GLRSApp.utils.triggerHaptic("light")):t<-s&&e>0&&(u(e-1),typeof window.GLRSApp?.utils?.triggerHaptic=="function"&&window.GLRSApp.utils.triggerHaptic("light")),l(!1),i(0),a(0)}});window.GLRSApp=window.GLRSApp||{shared:{}},window.GLRSApp.shared=window.GLRSApp.shared||{},window.GLRSApp.shared.touchHandlers={createLifeTouchHandlers,createFinancesTouchHandlers,createWellnessTouchHandlers},console.log("\u2705 Touch handlers loaded");const detectDayOfWeekPattern=n=>{if(!n||n.length<7)return null;const o={0:[],1:[],2:[],3:[],4:[],5:[],6:[]},e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];n.slice(0,30).forEach(r=>{if(!r.morningData)return;const y=(r.createdAt?.toDate?r.createdAt.toDate():new Date(r.createdAt)).getDay();o[y].push({mood:r.morningData.mood||3,craving:r.morningData.craving||3,anxiety:r.morningData.anxiety||3})});const i={};let a=0,l=0,u=0,g=0;if(Object.keys(o).forEach(r=>{if(o[r].length===0)return;const w=o[r].reduce((p,h)=>p+h.mood,0)/o[r].length,y=o[r].reduce((p,h)=>p+h.craving,0)/o[r].length,A=o[r].reduce((p,h)=>p+h.anxiety,0)/o[r].length;i[r]={mood:w,craving:y,anxiety:A},a+=w,l+=y,u+=A,g++}),g===0)return null;const c={mood:a/g,craving:l/g,anxiety:u/g};let d=null,t=null,s=null,f=5,m=0,v=0;return Object.keys(i).forEach(r=>{i[r].mood<f&&(f=i[r].mood,d=parseInt(r)),i[r].craving>m&&(m=i[r].craving,t=parseInt(r)),i[r].anxiety>v&&(v=i[r].anxiety,s=parseInt(r))}),d!==null&&c.mood-f>=1?{type:"dayOfWeek",metric:"mood",day:e[d],value:f.toFixed(1),message:`Your mood tends to dip on ${e[d]}s`,tips:[`Start your ${e[d]} with a morning routine`,`Schedule something enjoyable for ${e[d]} mornings`,`Connect with your accountability partner on ${e[d]}`,`Review your ${e[d]} triggers from past weeks`]}:t!==null&&m-c.craving>=1?{type:"dayOfWeek",metric:"craving",day:e[t],value:m.toFixed(1),message:`Your cravings spike on ${e[t]}s`,tips:[`Identify your ${e[t]} triggers (stress? social plans?)`,`Plan alternative activities for ${e[t]} evenings`,`Check in with your support group on ${e[t]}s`,`Practice grounding techniques on ${e[t]} afternoons`]}:s!==null&&v-c.anxiety>=1?{type:"dayOfWeek",metric:"anxiety",day:e[s],value:v.toFixed(1),message:`Your anxiety is higher on ${e[s]}s`,tips:[`Prepare for the week ahead on ${e[s-1>=0?s-1:6]} night`,`Practice ${e[s]} evening meditation`,`Limit social media on ${e[s]}s`,`Connect with supportive friends on ${e[s]}`]}:null},detectConsecutiveDaysPattern=n=>{if(!n||n.length<3)return null;let o=0,e=0,i=0,a=0;return n.slice(0,14).forEach(l=>{if(!l.morningData){o=0,e=0;return}const u=l.morningData.mood||3,g=l.morningData.craving||3;u<=2?(o++,i=Math.max(i,o)):o=0,g>=4?(e++,a=Math.max(a,e)):e=0}),i>=3?{type:"consecutive",metric:"lowMood",days:i,message:`You've had ${i} consecutive days of low mood. Let's address this.`,tips:["Consider reaching out to your coach today","Review your coping strategies - what's working?","Have you been completing your daily check-ins?","Physical activity can help - take a walk today"]}:a>=3?{type:"consecutive",metric:"highCraving",days:a,message:`High cravings for ${a} days in a row. Time for extra support.`,tips:["This is normal - cravings pass, you are strong","Call your accountability partner right now","Use the 5-minute rule: delay for 5 minutes, reassess","Review your relapse prevention plan in Guides"]}:null},detectTimeOfDayPattern=n=>{if(!n||n.length<7)return null;let o=0,e=0,i=0,a=0;if(n.slice(0,14).forEach(c=>{c.morningData&&c.morningData.mood&&(o+=c.morningData.mood,i++),c.eveningData&&c.eveningData.overallDay&&(e+=c.eveningData.overallDay,a++)}),i<5||a<5)return null;const l=o/i,u=e/a,g=l-u;return g<=-1?{type:"timeOfDay",metric:"morningsHarder",difference:Math.abs(g).toFixed(1),message:"Your mornings tend to be more challenging",tips:["Establish a consistent morning routine","Avoid checking phone first thing in the morning","Try morning meditation or stretching","Plan something positive for each morning"]}:g>=1?{type:"timeOfDay",metric:"eveningsHarder",difference:g.toFixed(1),message:"Your mood dips in the evenings",tips:["Avoid isolation in the evenings","Limit screen time after 8 PM","Call a friend or family member each evening","Practice evening reflection to process your day"]}:null},detectPatterns=n=>!n||n.length===0?null:detectDayOfWeekPattern(n)||detectConsecutiveDaysPattern(n)||detectTimeOfDayPattern(n);window.GLRSApp=window.GLRSApp||{shared:{}},window.GLRSApp.shared=window.GLRSApp.shared||{},window.GLRSApp.shared.patternDetection={detectDayOfWeekPattern,detectConsecutiveDaysPattern,detectTimeOfDayPattern,detectPatterns},console.log("\u2705 Pattern detection algorithms loaded");
