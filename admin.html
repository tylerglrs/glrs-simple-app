<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLRS Admin Portal - Command Center</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Enhanced Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #f4c430 0%, #ffd54f 100%);
            border-radius: 20px;
            color: #1a365d;
        }
        
        .logo {
            font-size: 36px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: bold;
        }
        
        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .nav-section {
            margin-bottom: 25px;
        }
        
        .nav-section-title {
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
            padding-left: 10px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.2s ease;
            width: 100%;
            font-size: 15px;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .nav-item.active {
            background: rgba(244, 196, 48, 0.2);
            color: #f4c430;
            border: 1px solid rgba(244, 196, 48, 0.3);
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        .nav-badge {
            margin-left: auto;
            background: #ff4757;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .page-title {
            color: white;
            font-size: 28px;
            font-weight: bold;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 8px 20px;
            width: 300px;
        }
        
        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            flex: 1;
            outline: none;
            margin-left: 10px;
        }
        
        .search-bar input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .notification-btn {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
        }
        
        .notification-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .admin-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            overflow: hidden;
        }
        
        .admin-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Content Area */
        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }
        
        .stat-change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-change.positive {
            color: #00ff88;
        }
        
        .stat-change.negative {
            color: #ff4757;
        }
        
        /* Activity Feed */
        .activity-feed {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .feed-title {
            font-size: 20px;
            font-weight: bold;
            color: white;
        }
        
        .feed-filters {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .filter-btn.active {
            background: rgba(244, 196, 48, 0.2);
            border-color: #f4c430;
            color: #f4c430;
        }
        
        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .activity-item {
            display: flex;
            align-items: start;
            gap: 15px;
            padding: 15px;
            border-radius: 12px;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .activity-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .activity-icon.check-in {
            background: rgba(76, 175, 80, 0.2);
        }
        
        .activity-icon.message {
            background: rgba(33, 150, 243, 0.2);
        }
        
        .activity-icon.alert {
            background: rgba(255, 71, 87, 0.2);
        }
        
        .activity-icon.assignment {
            background: rgba(255, 152, 0, 0.2);
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            color: white;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .activity-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }
        
        .activity-action {
            padding: 6px 12px;
            background: rgba(244, 196, 48, 0.2);
            border: 1px solid #f4c430;
            color: #f4c430;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .activity-action:hover {
            background: rgba(244, 196, 48, 0.3);
        }
        
        /* User Grid */
        .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .user-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border-color: rgba(244, 196, 48, 0.3);
        }
        
        .user-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
        }
        
        .user-role {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(244, 196, 48, 0.2);
            border-radius: 12px;
            color: #f4c430;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .user-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .user-stat {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .user-stat-value {
            font-size: 20px;
            font-weight: bold;
            color: white;
        }
        
        .user-stat-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        /* Message Center */
        .message-center {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            height: calc(100vh - 200px);
        }
        
        .conversation-list {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .conversation-search {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 10px 15px;
            margin-bottom: 20px;
        }
        
        .conversation-search input {
            background: transparent;
            border: none;
            color: white;
            flex: 1;
            outline: none;
            margin-left: 10px;
        }
        
        .conversation-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 10px;
        }
        
        .conversation-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .conversation-item.active {
            background: rgba(244, 196, 48, 0.2);
            border: 1px solid rgba(244, 196, 48, 0.3);
        }
        
        .conversation-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .conversation-details {
            flex: 1;
            min-width: 0;
        }
        
        .conversation-name {
            color: white;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .conversation-preview {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .conversation-meta {
            text-align: right;
        }
        
        .conversation-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
            margin-bottom: 5px;
        }
        
        .unread-count {
            display: inline-block;
            background: #ff4757;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .chat-view {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        
        .message.sent {
            align-self: flex-end;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .message.received {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .chat-input {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 15px;
        }
        
        .chat-input input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            outline: none;
        }
        
        .chat-input button {
            background: linear-gradient(135deg, #f4c430 0%, #ffd54f 100%);
            color: #1a365d;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        /* Feedback Hub */
        .feedback-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .feedback-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .feedback-stats {
            display: flex;
            gap: 30px;
        }
        
        .feedback-stat {
            text-align: center;
        }
        
        .feedback-stat-value {
            font-size: 32px;
            font-weight: bold;
            color: white;
        }
        
        .feedback-stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        .feedback-list {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
        }
        
        .feedback-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .feedback-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .feedback-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .feedback-author {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .feedback-author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .feedback-author-name {
            color: white;
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .feedback-date {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }
        
        .feedback-priority {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .feedback-priority.critical {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }
        
        .feedback-priority.important {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }
        
        .feedback-priority.suggestion {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }
        
        .feedback-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .feedback-actions {
            display: flex;
            gap: 10px;
        }
        
        .feedback-action-btn {
            padding: 6px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .feedback-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        /* Resource Management */
        .resource-management {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
        }
        
        .resource-sidebar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
        }
        
        .resource-categories {
            margin-bottom: 30px;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }
        
        .category-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .category-item.active {
            background: rgba(244, 196, 48, 0.2);
            border: 1px solid rgba(244, 196, 48, 0.3);
        }
        
        .category-name {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: 500;
        }
        
        .category-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .resource-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
        }
        
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .resource-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .resource-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }
        
        .resource-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .resource-title {
            color: white;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .resource-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .resource-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 25px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            transition: all 0.2s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #f4c430;
            background: rgba(255, 255, 255, 0.15);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            color: white;
            cursor: pointer;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 15px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f4c430 0%, #ffd54f 100%);
            color: #1a365d;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 196, 48, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        }
        
        /* Loading State */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #f4c430;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 20px;
            color: white;
            font-size: 18px;
        }
        
        /* Login Screen */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .login-title {
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        .quick-action-btn {
            padding: 10px 20px;
            background: rgba(244, 196, 48, 0.2);
            border: 1px solid #f4c430;
            color: #f4c430;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .quick-action-btn:hover {
            background: rgba(244, 196, 48, 0.3);
            transform: translateY(-2px);
        }
        
        /* Charts Container */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 20px;
        }
        
        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn:hover {
            color: white;
        }
        
        .tab-btn.active {
            color: #f4c430;
            border-bottom-color: #f4c430;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 999;
                transition: left 0.3s ease;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .message-center {
                grid-template-columns: 1fr;
            }
            
            .resource-management {
                grid-template-columns: 1fr;
            }
            
            .user-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAufSTHtCTFSEIeZ9YzvrULCnji5I-SMi0",
            authDomain: "glrs-pir-system.firebaseapp.com",
            projectId: "glrs-pir-system",
            storageBucket: "glrs-pir-system.firebasestorage.app",
            messagingSenderId: "830378577655",
            appId: "1:830378577655:web:ceb8e57c80f9b1cc028df2",
            measurementId: "G-W5JDNQ9J1X"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        const { useState, useEffect, useRef } = React;
        
        // Main Admin App Component
        function AdminApp() {
            const [loading, setLoading] = useState(true);
            const [admin, setAdmin] = useState(null);
            const [adminData, setAdminData] = useState(null);
            const [currentView, setCurrentView] = useState('dashboard');
            const [selectedUser, setSelectedUser] = useState(null);
            const [showModal, setShowModal] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [unreadCount, setUnreadCount] = useState(0);
            
            // All data states
            const [allUsers, setAllUsers] = useState([]);
            const [pirs, setPirs] = useState([]);
            const [coaches, setCoaches] = useState([]);
            const [activities, setActivities] = useState([]);
            const [alerts, setAlerts] = useState([]);
            const [messages, setMessages] = useState([]);
            const [checkIns, setCheckIns] = useState([]);
            const [assignments, setAssignments] = useState([]);
            const [resources, setResources] = useState([]);
            const [supportGroups, setSupportGroups] = useState([]);
            const [feedback, setFeedback] = useState([]);
            const [systemStats, setSystemStats] = useState({
                totalPirs: 0,
                activePirs: 0,
                totalCoaches: 0,
                checkInRate: 0,
                sosAlerts: 0,
                pendingFeedback: 0,
                messagesAwaitingResponse: 0,
                overdueAssignments: 0
            });
            
            // Real-time listeners
            const listeners = useRef([]);
            
            // Auth listener
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        await loadAdminData(user.uid);
                    } else {
                        setLoading(false);
                    }
                });
                
                return () => unsubscribe();
            }, []);
            
            // Load admin data and verify role
            const loadAdminData = async (uid) => {
                try {
                    const adminDoc = await db.collection('users').doc(uid).get();
                    if (adminDoc.exists) {
                        const data = adminDoc.data();
                        
                        // Verify admin role
                        if (data.role !== 'admin') {
                            alert('Access denied. Admin privileges required.');
                            await auth.signOut();
                            return;
                        }
                        
                        setAdmin(auth.currentUser);
                        setAdminData(data);
                        
                        // Load all system data
                        await loadSystemData();
                        
                        // Set up real-time listeners
                        setupRealtimeListeners();
                    } else {
                        // Create admin profile if doesn't exist
                        await createAdminProfile(uid, auth.currentUser.email);
                    }
                } catch (error) {
                    console.error('Error loading admin data:', error);
                    alert('Error loading admin data. Please try again.');
                } finally {
                    setLoading(false);
                }
            };
            
            // Create admin profile
            const createAdminProfile = async (uid, email) => {
                const newAdminData = {
                    email: email,
                    displayName: 'System Admin',
                    role: 'admin',
                    firstName: '',
                    lastName: '',
                    phone: '',
                    permissions: {
                        viewAllData: true,
                        modifyUsers: true,
                        accessMessages: true,
                        manageSystem: true
                    },
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(uid).set(newAdminData);
                setAdminData(newAdminData);
            };
            
            // Load all system data
            const loadSystemData = async () => {
                try {
                    // Load all users
                    const usersSnapshot = await db.collection('users').get();
                    const usersList = [];
                    const pirsList = [];
                    const coachesList = [];
                    
                    for (const doc of usersSnapshot.docs) {
                        const userData = { id: doc.id, ...doc.data() };
                        usersList.push(userData);
                        
                        if (userData.role === 'pir') {
                            // Get latest check-in for PIR
                            const checkInSnapshot = await db.collection('checkIns')
                                .where('userId', '==', doc.id)
                                .orderBy('createdAt', 'desc')
                                .limit(1)
                                .get();
                            
                            const lastCheckIn = !checkInSnapshot.empty ? 
                                checkInSnapshot.docs[0].data() : null;
                            
                            pirsList.push({ ...userData, lastCheckIn });
                        } else if (userData.role === 'coach') {
                            // Get coach stats
                            const assignedPirsSnapshot = await db.collection('users')
                                .where('assignedCoach', '==', doc.id)
                                .where('role', '==', 'pir')
                                .get();
                            
                            coachesList.push({
                                ...userData,
                                assignedPirsCount: assignedPirsSnapshot.size
                            });
                        }
                    }
                    
                    setAllUsers(usersList);
                    setPirs(pirsList);
                    setCoaches(coachesList);
                    
                    // Load activities
                    const activitiesSnapshot = await db.collection('activities')
                        .orderBy('createdAt', 'desc')
                        .limit(50)
                        .get();
                    
                    const activitiesList = activitiesSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setActivities(activitiesList);
                    
                    // Load alerts
                    const alertsSnapshot = await db.collection('alerts')
                        .where('status', '==', 'active')
                        .get();
                    
                    const alertsList = alertsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setAlerts(alertsList);
                    
                    // Load feedback
                    const feedbackSnapshot = await db.collection('feedback')
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    const feedbackList = feedbackSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setFeedback(feedbackList);
                    
                    // Load resources
                    const resourcesSnapshot = await db.collection('resources').get();
                    const resourcesList = resourcesSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setResources(resourcesList);
                    
                    // Load support groups
                    const groupsSnapshot = await db.collection('supportGroups').get();
                    const groupsList = groupsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setSupportGroups(groupsList);
                    
                    // Calculate system stats
                    calculateSystemStats(pirsList, coachesList, alertsList, feedbackList);
                    
                } catch (error) {
                    console.error('Error loading system data:', error);
                }
            };
            
            // Calculate system statistics
            const calculateSystemStats = (pirs, coaches, alerts, feedback) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const activePirs = pirs.filter(p => {
                    if (p.lastCheckIn) {
                        const checkInDate = p.lastCheckIn.createdAt?.toDate() || new Date(0);
                        return checkInDate >= today;
                    }
                    return false;
                });
                
                const pendingFeedback = feedback.filter(f => !f.reviewed).length;
                const sosAlerts = alerts.filter(a => a.severity === 'critical').length;
                
                setSystemStats({
                    totalPirs: pirs.length,
                    activePirs: activePirs.length,
                    totalCoaches: coaches.length,
                    checkInRate: pirs.length > 0 ? 
                        Math.round((activePirs.length / pirs.length) * 100) : 0,
                    sosAlerts: sosAlerts,
                    pendingFeedback: pendingFeedback,
                    messagesAwaitingResponse: 0, // Will be calculated from messages
                    overdueAssignments: 0 // Will be calculated from assignments
                });
            };
            
            // Set up real-time listeners
            const setupRealtimeListeners = () => {
                // Clear existing listeners
                listeners.current.forEach(unsubscribe => unsubscribe());
                listeners.current = [];
                
                // Listen to activities
                const activitiesListener = db.collection('activities')
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .onSnapshot(snapshot => {
                        const activitiesList = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setActivities(activitiesList);
                    });
                listeners.current.push(activitiesListener);
                
                // Listen to alerts
                const alertsListener = db.collection('alerts')
                    .where('status', '==', 'active')
                    .onSnapshot(snapshot => {
                        const alertsList = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setAlerts(alertsList);
                        
                        // Update SOS count
                        const sosCount = alertsList.filter(a => a.severity === 'critical').length;
                        setSystemStats(prev => ({ ...prev, sosAlerts: sosCount }));
                    });
                listeners.current.push(alertsListener);
                
                // Listen to feedback
                const feedbackListener = db.collection('feedback')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot(snapshot => {
                        const feedbackList = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setFeedback(feedbackList);
                        
                        const pendingCount = feedbackList.filter(f => !f.reviewed).length;
                        setSystemStats(prev => ({ ...prev, pendingFeedback: pendingCount }));
                    });
                listeners.current.push(feedbackListener);
                
                // Listen to messages
                const messagesListener = db.collection('messages')
                    .orderBy('createdAt', 'desc')
                    .limit(100)
                    .onSnapshot(snapshot => {
                        const messagesList = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setMessages(messagesList);
                    });
                listeners.current.push(messagesListener);
            };
            
            // Cleanup listeners on unmount
            useEffect(() => {
                return () => {
                    listeners.current.forEach(unsubscribe => unsubscribe());
                };
            }, []);
            
            // Handle logout
            const handleLogout = async () => {
                try {
                    await auth.signOut();
                } catch (error) {
                    console.error('Error logging out:', error);
                }
            };
            
            // Render loading state
            if (loading) {
                return (
                    <div className="loading-container">
                        <div className="loading-spinner"></div>
                        <div className="loading-text">Loading Admin Portal...</div>
                    </div>
                );
            }
            
            // Render login if no admin
            if (!admin) {
                return <LoginScreen />;
            }
            
            // Main admin interface
            return (
                <div className="app-container">
                    <Sidebar 
                        currentView={currentView}
                        onViewChange={setCurrentView}
                        alerts={alerts}
                        feedback={feedback}
                        onLogout={handleLogout}
                    />
                    
                    <div className="main-content">
                        <Header 
                            adminData={adminData}
                            currentView={currentView}
                            notifications={notifications}
                            unreadCount={unreadCount}
                        />
                        
                        <div className="content-area">
                            {currentView === 'dashboard' && (
                                <DashboardView 
                                    stats={systemStats}
                                    activities={activities}
                                    alerts={alerts}
                                    pirs={pirs}
                                    coaches={coaches}
                                />
                            )}
                            
                            {currentView === 'users' && (
                                <UsersView 
                                    pirs={pirs}
                                    coaches={coaches}
                                    onSelectUser={setSelectedUser}
                                    onShowModal={setShowModal}
                                />
                            )}
                            
                            {currentView === 'messages' && (
                                <MessagesView 
                                    messages={messages}
                                    users={allUsers}
                                    admin={admin}
                                />
                            )}
                            
                            {currentView === 'feedback' && (
                                <FeedbackView 
                                    feedback={feedback}
                                    users={allUsers}
                                />
                            )}
                            
                            {currentView === 'resources' && (
                                <ResourcesView 
                                    resources={resources}
                                    onShowModal={setShowModal}
                                />
                            )}
                            
                            {currentView === 'checkins' && (
                                <CheckInsView 
                                    checkIns={checkIns}
                                    pirs={pirs}
                                />
                            )}
                            
                            {currentView === 'assignments' && (
                                <AssignmentsView 
                                    assignments={assignments}
                                    pirs={pirs}
                                    coaches={coaches}
                                />
                            )}
                            
                            {currentView === 'groups' && (
                                <GroupsView 
                                    groups={supportGroups}
                                    pirs={pirs}
                                    onShowModal={setShowModal}
                                />
                            )}
                            
                            {currentView === 'reports' && (
                                <ReportsView 
                                    pirs={pirs}
                                    coaches={coaches}
                                    activities={activities}
                                    systemStats={systemStats}
                                />
                            )}
                            
                            {currentView === 'settings' && (
                                <SettingsView 
                                    adminData={adminData}
                                    onUpdate={(data) => setAdminData(prev => ({...prev, ...data}))}
                                />
                            )}
                            
                            {selectedUser && (
                                <UserDetailView 
                                    user={selectedUser}
                                    onBack={() => setSelectedUser(null)}
                                    onShowModal={setShowModal}
                                />
                            )}
                        </div>
                    </div>
                    
                    {showModal && (
                        <Modal 
                            type={showModal}
                            onClose={() => setShowModal(null)}
                            users={allUsers}
                            onRefresh={loadSystemData}
                        />
                    )}
                </div>
            );
        }
        
        // Sidebar Component
        function Sidebar({ currentView, onViewChange, alerts, feedback, onLogout }) {
            const sosCount = alerts.filter(a => a.severity === 'critical').length;
            const pendingFeedbackCount = feedback.filter(f => !f.reviewed).length;
            
            return (
                <div className="sidebar">
                    <div className="logo-section">
                        <span className="logo">🛡️</span>
                        <span className="logo-text">Admin Portal</span>
                    </div>
                    
                    <nav className="nav-menu">
                        <div className="nav-section">
                            <div className="nav-section-title">Main</div>
                            <button
                                className={`nav-item ${currentView === 'dashboard' ? 'active' : ''}`}
                                onClick={() => onViewChange('dashboard')}
                            >
                                <span className="nav-icon">📊</span>
                                <span>Dashboard</span>
                            </button>
                            
                            <button
                                className={`nav-item ${currentView === 'users' ? 'active' : ''}`}
                                onClick={() => onViewChange('users')}
                            >
                                <span className="nav-icon">👥</span>
                                <span>Users</span>
                            </button>
                            
                            <button
                                className={`nav-item ${currentView === 'messages' ? 'active' : ''}`}
                                onClick={() => onViewChange('messages')}
                            >
                                <span className="nav-icon">💬</span>
                                <span>Messages</span>
                            </button>
                        </div>
                        
                        <div className="nav-section">
                            <div className="nav-section-title">Management</div>
                            <button
                                className={`nav-item ${currentView === 'feedback' ? 'active' : ''}`}
                                onClick={() => onViewChange('feedback')}
                            >
                                <span className="nav-icon">📝</span>
                                <span>Feedback</span>
                                {pendingFeedbackCount > 0 && (
                                    <span className="nav-badge">{pendingFeedbackCount}</span>
                                )}
                            </button>
                            
                            <button
                                className={`nav-item ${currentView === 'resources' ? 'active' : ''}`}
                                onClick={() => onViewChange('resources')}
                            >
                                <span className="nav-icon">📚</span>
                                <span>Resources</span>
                            </button>
                            
                            <button
                                className={`nav-item ${currentView === 'groups' ? 'active' : ''}`}
                                onClick={() => onViewChange('groups')}
                            >
                                <span className="nav-icon">🏘️</span>
                                <span>Groups</span>
                            </button>
                        </div>
                        
                        <div className="nav-section">
                            <div className="nav-section-title">Monitoring</div>
                            <button
                                className={`nav-item ${currentView === 'checkins' ? 'active' : ''}`}
                                onClick={() => onViewChange('checkins')}
                            >
                                <span className="nav-icon">✅</span>
                                <span>Check-ins</span>
                            </button>
                            
                            <button
                                className={`nav-item ${currentView === 'assignments' ? 'active' : ''}`}
                                onClick={() => onViewChange('assignments')}
                            >
                                <span className="nav-icon">📋</span>
                                <span>Assignments</span>
                            </button>
                            
                            <button
                                className={`nav-item ${currentView === 'alerts' ? 'active' : ''}`}
                                onClick={() => onViewChange('alerts')}
                                style={{color: sosCount > 0 ? '#ff4757' : ''}}
                            >
                                <span className="nav-icon">🚨</span>
                                <span>Alerts</span>
                                {sosCount > 0 && (
                                    <span className="nav-badge">{sosCount}</span>
                                )}
                            </button>
                        </div>
                        
                        <div className="nav-section">
                            <div className="nav-section-title">System</div>
                            <button
                                className={`nav-item ${currentView === 'reports' ? 'active' : ''}`}
                                onClick={() => onViewChange('reports')}
                            >
                                <span className="nav-icon">📈</span>
                                <span>Reports</span>
                            </button>
                            
                            <button
                                className={`nav-item ${currentView === 'settings' ? 'active' : ''}`}
                                onClick={() => onViewChange('settings')}
                            >
                                <span className="nav-icon">⚙️</span>
                                <span>Settings</span>
                            </button>
                            
                            <button
                                className="nav-item"
                                onClick={onLogout}
                            >
                                <span className="nav-icon">🚪</span>
                                <span>Logout</span>
                            </button>
                        </div>
                    </nav>
                </div>
            );
        }
        
        // Header Component
        function Header({ adminData, currentView, notifications, unreadCount }) {
            const [showNotifications, setShowNotifications] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            
            const getPageTitle = () => {
                const titles = {
                    dashboard: 'Dashboard',
                    users: 'User Management',
                    messages: 'Message Center',
                    feedback: 'Feedback Hub',
                    resources: 'Resource Management',
                    groups: 'Groups & Workshops',
                    checkins: 'Check-in Monitoring',
                    assignments: 'Assignment Tracking',
                    alerts: 'Emergency Alerts',
                    reports: 'Reports & Analytics',
                    settings: 'System Settings'
                };
                return titles[currentView] || 'Admin Portal';
            };
            
            return (
                <div className="header">
                    <div className="header-left">
                        <h1 className="page-title">{getPageTitle()}</h1>
                    </div>
                    
                    <div className="header-actions">
                        <div className="search-bar">
                            <span>🔍</span>
                            <input 
                                type="text"
                                placeholder="Search users, messages, resources..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>
                        
                        <button className="notification-btn" onClick={() => setShowNotifications(!showNotifications)}>
                            🔔
                            {unreadCount > 0 && <span className="notification-badge">{unreadCount}</span>}
                        </button>
                        
                        <div className="admin-avatar">
                            {adminData?.profileImageUrl ? (
                                <img src={adminData.profileImageUrl} alt="Admin" />
                            ) : (
                                'A'
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        // Dashboard View
        function DashboardView({ stats, activities, alerts, pirs, coaches }) {
            return (
                <>
                    <div className="quick-actions">
                        <button className="quick-action-btn">➕ Add PIR</button>
                        <button className="quick-action-btn">📢 Broadcast Message</button>
                        <button className="quick-action-btn">📄 Generate Report</button>
                        <button className="quick-action-btn">🆘 View SOS Alerts</button>
                        <button className="quick-action-btn">💾 Backup Data</button>
                    </div>
                    
                    <div className="dashboard-grid">
                        <div className="stat-card">
                            <div className="stat-label">Total PIRs</div>
                            <div className="stat-value">{stats.totalPirs}</div>
                            <div className="stat-change positive">
                                ↑ Active Today: {stats.activePirs}
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-label">Check-in Rate</div>
                            <div className="stat-value">{stats.checkInRate}%</div>
                            <div className="stat-change positive">
                                ↑ 5% from yesterday
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-label">Active Coaches</div>
                            <div className="stat-value">{stats.totalCoaches}</div>
                            <div className="stat-change">
                                Avg caseload: {stats.totalPirs > 0 ? Math.round(stats.totalPirs / stats.totalCoaches) : 0}
                            </div>
                        </div>
                        
                        <div className="stat-card" style={{borderColor: stats.sosAlerts > 0 ? '#ff4757' : ''}}>
                            <div className="stat-label">SOS Alerts</div>
                            <div className="stat-value" style={{color: stats.sosAlerts > 0 ? '#ff4757' : ''}}>{stats.sosAlerts}</div>
                            <div className="stat-change negative">
                                {stats.sosAlerts > 0 ? '⚠️ Requires immediate attention' : '✓ All clear'}
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-label">Pending Feedback</div>
                            <div className="stat-value">{stats.pendingFeedback}</div>
                            <div className="stat-change">
                                Awaiting review
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-label">Response Queue</div>
                            <div className="stat-value">{stats.messagesAwaitingResponse}</div>
                            <div className="stat-change">
                                Messages needing coach response
                            </div>
                        </div>
                    </div>
                    
                    <div className="activity-feed">
                        <div className="feed-header">
                            <h2 className="feed-title">Live Activity Feed</h2>
                            <div className="feed-filters">
                                <button className="filter-btn active">All</button>
                                <button className="filter-btn">Check-ins</button>
                                <button className="filter-btn">Messages</button>
                                <button className="filter-btn">Alerts</button>
                            </div>
                        </div>
                        
                        <div className="activity-list">
                            {activities.map(activity => (
                                <div key={activity.id} className="activity-item">
                                    <div className={`activity-icon ${activity.type}`}>
                                        {activity.type === 'check-in' && '✅'}
                                        {activity.type === 'message' && '💬'}
                                        {activity.type === 'alert' && '🚨'}
                                        {activity.type === 'assignment' && '📋'}
                                    </div>
                                    <div className="activity-content">
                                        <div className="activity-title">{activity.title}</div>
                                        <div className="activity-time">{formatTime(activity.createdAt)}</div>
                                    </div>
                                    <button className="activity-action">View</button>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    <div className="charts-grid">
                        <div className="chart-card">
                            <h3 className="chart-title">Check-in Trends (7 Days)</h3>
                            <canvas id="checkinChart"></canvas>
                        </div>
                        
                        <div className="chart-card">
                            <h3 className="chart-title">Mood Distribution</h3>
                            <canvas id="moodChart"></canvas>
                        </div>
                    </div>
                </>
            );
        }
        
        // Users View
        function UsersView({ pirs, coaches, onSelectUser, onShowModal }) {
            const [activeTab, setActiveTab] = useState('pirs');
            const [searchQuery, setSearchQuery] = useState('');
            
            const filteredPirs = pirs.filter(p => 
                p.displayName?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                p.email?.toLowerCase().includes(searchQuery.toLowerCase())
            );
            
            const filteredCoaches = coaches.filter(c =>
                c.displayName?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                c.email?.toLowerCase().includes(searchQuery.toLowerCase())
            );
            
            return (
                <>
                    <div className="tab-nav">
                        <button 
                            className={`tab-btn ${activeTab === 'pirs' ? 'active' : ''}`}
                            onClick={() => setActiveTab('pirs')}
                        >
                            PIRs ({pirs.length})
                        </button>
                        <button 
                            className={`tab-btn ${activeTab === 'coaches' ? 'active' : ''}`}
                            onClick={() => setActiveTab('coaches')}
                        >
                            Coaches ({coaches.length})
                        </button>
                    </div>
                    
                    <div className="conversation-search" style={{marginBottom: '20px'}}>
                        <span>🔍</span>
                        <input 
                            type="text"
                            placeholder="Search users..."
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                        />
                    </div>
                    
                    <div className="quick-actions">
                        <button className="quick-action-btn" onClick={() => onShowModal('createUser')}>
                            ➕ Create User
                        </button>
                        <button className="quick-action-btn" onClick={() => onShowModal('bulkAssign')}>
                            🔄 Bulk Reassign
                        </button>
                        <button className="quick-action-btn" onClick={() => onShowModal('exportData')}>
                            📥 Export Data
                        </button>
                    </div>
                    
                    {activeTab === 'pirs' && (
                        <div className="user-grid">
                            {filteredPirs.map(pir => (
                                <UserCard 
                                    key={pir.id}
                                    user={pir}
                                    role="pir"
                                    onClick={() => onSelectUser(pir)}
                                />
                            ))}
                        </div>
                    )}
                    
                    {activeTab === 'coaches' && (
                        <div className="user-grid">
                            {filteredCoaches.map(coach => (
                                <UserCard 
                                    key={coach.id}
                                    user={coach}
                                    role="coach"
                                    onClick={() => onSelectUser(coach)}
                                />
                            ))}
                        </div>
                    )}
                </>
            );
        }
        
        // User Card Component
        function UserCard({ user, role, onClick }) {
            const getDaysInRecovery = () => {
                if (user.sobrietyDate) {
                    const days = Math.floor((Date.now() - user.sobrietyDate.toDate()) / (1000 * 60 * 60 * 24));
                    return days;
                }
                return 0;
            };
            
            return (
                <div className="user-card" onClick={onClick}>
                    <div className="user-header">
                        <div className="user-avatar">
                            {user.profileImageUrl ? (
                                <img src={user.profileImageUrl} alt={user.displayName} />
                            ) : (
                                (user.displayName || user.email || 'U').charAt(0).toUpperCase()
                            )}
                        </div>
                        <div className="user-info">
                            <div className="user-name">
                                {user.displayName || user.email?.split('@')[0] || 'Unknown User'}
                            </div>
                            <div className="user-role">{role}</div>
                        </div>
                    </div>
                    
                    <div className="user-stats">
                        {role === 'pir' ? (
                            <>
                                <div className="user-stat">
                                    <div className="user-stat-value">{getDaysInRecovery()}</div>
                                    <div className="user-stat-label">Days</div>
                                </div>
                                <div className="user-stat">
                                    <div className="user-stat-value">
                                        {user.lastCheckIn ? '✓' : '✗'}
                                    </div>
                                    <div className="user-stat-label">Today</div>
                                </div>
                            </>
                        ) : (
                            <>
                                <div className="user-stat">
                                    <div className="user-stat-value">{user.assignedPirsCount || 0}</div>
                                    <div className="user-stat-label">PIRs</div>
                                </div>
                                <div className="user-stat">
                                    <div className="user-stat-value">98%</div>
                                    <div className="user-stat-label">Response</div>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        }
        
        // Messages View - Universal Message Center
        function MessagesView({ messages, users, admin }) {
            const [selectedConversation, setSelectedConversation] = useState(null);
            const [messageText, setMessageText] = useState('');
            const [searchQuery, setSearchQuery] = useState('');
            
            // Group messages by conversation
            const conversations = {};
            messages.forEach(msg => {
                const key = `${msg.senderId}-${msg.recipientId}`;
                const reverseKey = `${msg.recipientId}-${msg.senderId}`;
                
                if (!conversations[key] && !conversations[reverseKey]) {
                    conversations[key] = {
                        participants: [msg.senderId, msg.recipientId],
                        messages: [msg],
                        lastMessage: msg
                    };
                } else if (conversations[key]) {
                    conversations[key].messages.push(msg);
                } else if (conversations[reverseKey]) {
                    conversations[reverseKey].messages.push(msg);
                }
            });
            
            const sendMessage = async () => {
                if (!messageText.trim() || !selectedConversation) return;
                
                try {
                    await db.collection('messages').add({
                        senderId: admin.uid,
                        recipientId: selectedConversation.participants.find(p => p !== admin.uid),
                        text: messageText,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        read: false,
                        senderRole: 'admin'
                    });
                    
                    setMessageText('');
                } catch (error) {
                    console.error('Error sending message:', error);
                }
            };
            
            return (
                <div className="message-center">
                    <div className="conversation-list">
                        <div className="conversation-search">
                            <span>🔍</span>
                            <input 
                                type="text"
                                placeholder="Search conversations..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>
                        
                        {Object.values(conversations).map((conv, index) => {
                            const otherUserId = conv.participants.find(p => p !== admin.uid);
                            const otherUser = users.find(u => u.id === otherUserId);
                            
                            return (
                                <div 
                                    key={index}
                                    className={`conversation-item ${selectedConversation === conv ? 'active' : ''}`}
                                    onClick={() => setSelectedConversation(conv)}
                                >
                                    <div className="conversation-avatar">
                                        {otherUser?.displayName?.charAt(0) || 'U'}
                                    </div>
                                    <div className="conversation-details">
                                        <div className="conversation-name">
                                            {otherUser?.displayName || 'Unknown User'}
                                        </div>
                                        <div className="conversation-preview">
                                            {conv.lastMessage.text}
                                        </div>
                                    </div>
                                    <div className="conversation-meta">
                                        <div className="conversation-time">
                                            {formatTime(conv.lastMessage.createdAt)}
                                        </div>
                                        {!conv.lastMessage.read && <span className="unread-count">1</span>}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    <div className="chat-view">
                        {selectedConversation ? (
                            <>
                                <div className="chat-header">
                                    <div className="chat-user-info">
                                        <div className="conversation-avatar">
                                            {users.find(u => u.id === selectedConversation.participants.find(p => p !== admin.uid))?.displayName?.charAt(0) || 'U'}
                                        </div>
                                        <div>
                                            <div style={{color: 'white', fontWeight: '600'}}>
                                                {users.find(u => u.id === selectedConversation.participants.find(p => p !== admin.uid))?.displayName || 'Unknown User'}
                                            </div>
                                            <div style={{color: 'rgba(255,255,255,0.7)', fontSize: '14px'}}>
                                                {users.find(u => u.id === selectedConversation.participants.find(p => p !== admin.uid))?.role || 'User'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="chat-messages">
                                    {selectedConversation.messages.map(msg => (
                                        <div 
                                            key={msg.id}
                                            className={`message ${msg.senderId === admin.uid ? 'sent' : 'received'}`}
                                        >
                                            <div>{msg.text}</div>
                                            <div className="message-time">
                                                {formatTime(msg.createdAt)}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="chat-input">
                                    <input 
                                        type="text"
                                        placeholder="Type a message..."
                                        value={messageText}
                                        onChange={(e) => setMessageText(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                    />
                                    <button onClick={sendMessage}>Send</button>
                                </div>
                            </>
                        ) : (
                            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'rgba(255,255,255,0.5)'}}>
                                Select a conversation to view messages
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // Feedback View
        function FeedbackView({ feedback, users }) {
            const [filter, setFilter] = useState('all');
            const [selectedFeedback, setSelectedFeedback] = useState(null);
            
            const filteredFeedback = feedback.filter(f => {
                if (filter === 'all') return true;
                if (filter === 'unread') return !f.reviewed;
                if (filter === 'critical') return f.priority === 'critical';
                return true;
            });
            
            const markAsReviewed = async (feedbackId) => {
                try {
                    await db.collection('feedback').doc(feedbackId).update({
                        reviewed: true,
                        reviewedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.error('Error marking feedback as reviewed:', error);
                }
            };
            
            return (
                <div className="feedback-container">
                    <div className="feedback-header">
                        <div className="feedback-stats">
                            <div className="feedback-stat">
                                <div className="feedback-stat-value">{feedback.length}</div>
                                <div className="feedback-stat-label">Total Feedback</div>
                            </div>
                            <div className="feedback-stat">
                                <div className="feedback-stat-value">{feedback.filter(f => !f.reviewed).length}</div>
                                <div className="feedback-stat-label">Pending Review</div>
                            </div>
                            <div className="feedback-stat">
                                <div className="feedback-stat-value">{feedback.filter(f => f.priority === 'critical').length}</div>
                                <div className="feedback-stat-label">Critical</div>
                            </div>
                        </div>
                        
                        <div className="feed-filters">
                            <button 
                                className={`filter-btn ${filter === 'all' ? 'active' : ''}`}
                                onClick={() => setFilter('all')}
                            >
                                All
                            </button>
                            <button 
                                className={`filter-btn ${filter === 'unread' ? 'active' : ''}`}
                                onClick={() => setFilter('unread')}
                            >
                                Unread
                            </button>
                            <button 
                                className={`filter-btn ${filter === 'critical' ? 'active' : ''}`}
                                onClick={() => setFilter('critical')}
                            >
                                Critical
                            </button>
                        </div>
                    </div>
                    
                    <div className="feedback-list">
                        {filteredFeedback.map(item => {
                            const user = users.find(u => u.id === item.userId);
                            
                            return (
                                <div 
                                    key={item.id} 
                                    className="feedback-item"
                                    onClick={() => setSelectedFeedback(item)}
                                >
                                    <div className="feedback-item-header">
                                        <div className="feedback-author">
                                            <div className="feedback-author-avatar">
                                                {user?.displayName?.charAt(0) || 'U'}
                                            </div>
                                            <div>
                                                <div className="feedback-author-name">
                                                    {user?.displayName || 'Unknown User'}
                                                </div>
                                                <div className="feedback-date">
                                                    {formatTime(item.createdAt)}
                                                </div>
                                            </div>
                                        </div>
                                        <div className={`feedback-priority ${item.priority || 'suggestion'}`}>
                                            {item.priority || 'suggestion'}
                                        </div>
                                    </div>
                                    
                                    <div className="feedback-content">
                                        {item.content}
                                    </div>
                                    
                                    <div className="feedback-actions">
                                        {!item.reviewed && (
                                            <button 
                                                className="feedback-action-btn"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    markAsReviewed(item.id);
                                                }}
                                            >
                                                Mark as Reviewed
                                            </button>
                                        )}
                                        <button className="feedback-action-btn">
                                            Assign to Coach
                                        </button>
                                        <button className="feedback-action-btn">
                                            Reply
                                        </button>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }
        
        // Resources View
        function ResourcesView({ resources, onShowModal }) {
            const [selectedCategory, setSelectedCategory] = useState('all');
            const categories = [
                { id: 'all', name: 'All Resources', icon: '📚' },
                { id: 'recovery', name: 'Recovery Stages', icon: '🎯' },
                { id: 'coping', name: 'Coping Strategies', icon: '💪' },
                { id: 'educational', name: 'Educational', icon: '📖' },
                { id: 'worksheets', name: 'Worksheets', icon: '📝' },
                { id: 'emergency', name: 'Emergency', icon: '🆘' }
            ];
            
            const filteredResources = resources.filter(r => 
                selectedCategory === 'all' || r.category === selectedCategory
            );
            
            return (
                <div className="resource-management">
                    <div className="resource-sidebar">
                        <button 
                            className="btn btn-primary" 
                            style={{width: '100%', marginBottom: '20px'}}
                            onClick={() => onShowModal('createResource')}
                        >
                            ➕ Add Resource
                        </button>
                        
                        <div className="resource-categories">
                            {categories.map(cat => (
                                <div 
                                    key={cat.id}
                                    className={`category-item ${selectedCategory === cat.id ? 'active' : ''}`}
                                    onClick={() => setSelectedCategory(cat.id)}
                                >
                                    <div className="category-name">
                                        <span>{cat.icon}</span>
                                        <span>{cat.name}</span>
                                    </div>
                                    <div className="category-count">
                                        {cat.id === 'all' ? resources.length : 
                                         resources.filter(r => r.category === cat.id).length}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    <div className="resource-content">
                        <h2 style={{color: 'white', marginBottom: '20px'}}>
                            {categories.find(c => c.id === selectedCategory)?.name}
                        </h2>
                        
                        <div className="resource-grid">
                            {filteredResources.map(resource => (
                                <div key={resource.id} className="resource-card">
                                    <div className="resource-icon">
                                        {resource.type === 'pdf' && '📄'}
                                        {resource.type === 'video' && '🎥'}
                                        {resource.type === 'link' && '🔗'}
                                        {resource.type === 'document' && '📋'}
                                    </div>
                                    <div className="resource-title">{resource.title}</div>
                                    <div className="resource-description">
                                        {resource.description}
                                    </div>
                                    <div className="resource-meta">
                                        <span>{resource.downloads || 0} downloads</span>
                                        <span>{resource.type}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }
        
        // Other Views (placeholders for now)
        function CheckInsView() {
            return <div style={{color: 'white'}}>Check-ins Monitoring View</div>;
        }
        
        function AssignmentsView() {
            return <div style={{color: 'white'}}>Assignments Tracking View</div>;
        }
        
        function GroupsView() {
            return <div style={{color: 'white'}}>Groups & Workshops View</div>;
        }
        
        function ReportsView() {
            return <div style={{color: 'white'}}>Reports & Analytics View</div>;
        }
        
        function SettingsView() {
            return <div style={{color: 'white'}}>System Settings View</div>;
        }
        
        function UserDetailView({ user, onBack, onShowModal }) {
            return (
                <div style={{color: 'white'}}>
                    <button onClick={onBack} className="btn btn-secondary">← Back</button>
                    <h2>{user.displayName}</h2>
                    <p>Detailed user view with full access to all data</p>
                </div>
            );
        }
        
        // Modal Component
        function Modal({ type, onClose, users, onRefresh }) {
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">{type}</h2>
                            <button className="modal-close" onClick={onClose}>×</button>
                        </div>
                        <div>Modal content for {type}</div>
                    </div>
                </div>
            );
        }
        
        // Login Screen
        function LoginScreen() {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            
            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    console.error('Login error:', error);
                    alert('Login failed. Please check your credentials.');
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div className="login-container">
                    <div className="login-card">
                        <div className="login-logo">
                            <div className="login-logo-icon">🛡️</div>
                            <h1 className="login-title">Admin Portal</h1>
                            <p className="login-subtitle">GLRS Command Center</p>
                        </div>
                        
                        <form onSubmit={handleLogin}>
                            <div className="form-group">
                                <label className="form-label">Email</label>
                                <input 
                                    type="email"
                                    className="form-input"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Password</label>
                                <input 
                                    type="password"
                                    className="form-input"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <button 
                                type="submit"
                                className="btn btn-primary"
                                style={{width: '100%'}}
                                disabled={loading}
                            >
                                {loading ? 'Logging in...' : 'Login'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }
        
        // Utility functions
        function formatTime(timestamp) {
            if (!timestamp) return '';
            
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            
            return date.toLocaleDateString();
        }
        
        // Render the app
        ReactDOM.render(<AdminApp />, document.getElementById('root'));
    </script>
</body>
</html>
