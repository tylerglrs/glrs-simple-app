<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLRS Recovery Connect</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="glrs-logo.png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Modern CSS -->
    <link rel="stylesheet" href="modern-style.css">
</head>
<body>
    <div id="app">
        <!-- Loading Screen -->
        <div id="loadingScreen" class="loading-screen show" style="display: flex;">
            <div class="loading-content">
                <img src="glrs-logo.png" alt="GLRS Logo" class="loading-logo">
                <div class="loading-spinner"></div>
                <p>Loading your recovery journey...</p>
            </div>
        </div>

        <!-- Terms & Conditions Modal -->
        <div id="termsModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <img src="glrs-logo.png" alt="GLRS Logo" class="modal-logo">
                    <h2>Terms of Service & Privacy Policy</h2>
                </div>
                <div class="terms-scroll">
                    <div class="terms-section">
                        <h3>ðŸš¨ IMPORTANT NOTICE</h3>
                        <div class="alert alert-warning">
                            <strong>THIS IS NOT A CRISIS SERVICE.</strong> If you are experiencing thoughts of self-harm or suicide, we are required by law to contact emergency services for a 5150 evaluation. Please call 988 for the Suicide & Crisis Lifeline instead.
                        </div>
                    </div>
                    
                    <div class="terms-section">
                        <h3>Service Description</h3>
                        <p>Guiding Light Recovery Services LLC provides professional NON-CLINICAL peer support and recovery coaching services designed to complement your recovery journey. Our certified recovery coaches are professionals with extensive training and lived experience in recovery. While we maintain the highest professional standards, we are not licensed therapists, counselors, psychiatrists, or medical doctors. Our peer support services work alongside and complement clinical treatment but do not replace medical or psychiatric care.</p>
                        
                        <p>Our services include Recovery Success Planning (RSP), individual and group peer support meetings, transportation assistance (in designated areas), family education resources, recovery navigation, and connection to community resources. All services are provided by trained professionals who understand the recovery journey through both professional education and personal experience.</p>
                    </div>
                    
                    <div class="terms-section">
                        <h3>Code of Conduct</h3>
                        <p>This platform is a professional recovery support environment. All users must maintain appropriate behavior and communications. The following are strictly prohibited:</p>
                        <ul>
                            <li>Use of profanity, vulgar language, or inappropriate content</li>
                            <li>Discussion of illegal activities including drug sales, procurement, or distribution</li>
                            <li>Sharing or requesting contact information for illegal purposes</li>
                            <li>Harassment, bullying, or threatening behavior toward any user</li>
                            <li>Sexual content, solicitation, or inappropriate romantic advances</li>
                            <li>Promoting or glorifying substance use or relapse behaviors</li>
                            <li>Sharing graphic descriptions of drug use or "war stories"</li>
                            <li>Attempting to meet other users for purposes unrelated to recovery support</li>
                            <li>Spam, scams, or commercial solicitation</li>
                            <li>Discriminatory language or hate speech of any kind</li>
                        </ul>
                        
                        <p>Violation of these standards will result in immediate account suspension and potential termination of services. We maintain a zero-tolerance policy for behavior that threatens the safety or recovery of our community members.</p>
                    </div>
                    
                    <div class="terms-section">
                        <h3>Age Requirement</h3>
                        <p>You must be 18 years or older to use this service. Minors seeking recovery support should be directed to age-appropriate services with parental consent.</p>
                    </div>
                    
                    <div class="terms-section">
                        <h3>Data Collection & Privacy</h3>
                        <p>To provide comprehensive recovery support services, we collect and maintain the following information:</p>
                        <ul>
                            <li>Personal identification: Full legal name, chosen name, date of birth, and government-issued ID verification</li>
                            <li>Contact information: Email address, phone numbers, physical address, emergency contacts</li>
                            <li>Recovery information: Sobriety date, substance use history, recovery goals, support needs</li>
                            <li>Health information: Relevant medical conditions, medications (for safety during transport), mental health considerations</li>
                            <li>Session data: Attendance records, check-in responses, progress notes, goal achievements</li>
                            <li>Communication logs: Messages between peers (monitored for safety), coach communications, group participation</li>
                            <li>Family information: Authorized family contacts, family session notes, support system details</li>
                            <li>Legal information: Court requirements, probation status, mandated reporting obligations</li>
                            <li>Financial records: Payment history, billing information, insurance details where applicable</li>
                        </ul>
                    </div>
                </div>
                
                <div class="terms-footer">
                    <div class="terms-agreement">
                        <label class="checkbox-label">
                            <input type="checkbox" id="agreeCheckbox" onchange="toggleAcceptButton()">
                            <span class="checkbox-custom"></span>
                            <span>I am 18 or older and agree to the Terms of Service and Privacy Policy</span>
                        </label>
                    </div>
                    <button id="acceptTerms" class="btn btn-primary btn-lg" onclick="acceptTerms()" disabled>
                        Accept and Continue
                    </button>
                </div>
            </div>
        </div>

        <!-- Password Change Modal -->
        <div id="passwordModal" class="modal" style="display: none;">
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h2>Create Your Password</h2>
                    <p>For security, please create a new password for your account.</p>
                </div>
                <form onsubmit="changePassword(event); return false;">
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="newPassword" placeholder="Min 8 characters" required>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="confirmPassword" placeholder="Confirm your password" required>
                    </div>
                    <div class="password-requirements">
                        <p>Password must be at least 8 characters long</p>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">Update Password</button>
                </form>
            </div>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen" style="display: none;">
            <div class="login-container">
                <div class="login-header">
                    <img src="glrs-logo.png" alt="GLRS Logo" class="login-logo">
                    <h1>Recovery Connect</h1>
                    <p>Your journey to recovery starts here</p>
                </div>
                
                <form onsubmit="login(event); return false;" class="login-form">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginInput" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="password" placeholder="Enter your password" required>
                    </div>
                    <div class="form-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="rememberMe">
                            <span class="checkbox-custom"></span>
                            <span>Remember me</span>
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                        Sign In
                    </button>
                    <p class="login-help">Contact your coach if you forgot your password</p>
                </form>
            </div>
        </div>
        
        <!-- User info display -->
        <div id="userInfo" class="user-info hidden">
            <!-- This will be populated dynamically -->
        </div>
        
        <!-- PIR Main Interface -->
        <div id="pirInterface" class="main-interface hidden">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="top-bar-content">
                    <div class="logo-section">
                        <img src="glrs-logo.png" alt="GLRS Logo" class="header-logo">
                        <span class="app-name">Recovery Connect</span>
                    </div>
                    <div class="user-section">
                        <span id="userName" class="user-name"></span>
                        <span id="userTier" class="tier-badge"></span>
                        <button onclick="logout()" class="btn btn-ghost btn-sm">
                            <i data-lucide="log-out"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Dashboard Section -->
                <div id="dashboardSection" class="content-section active">
                    <!-- Hero Section -->
                    <div class="hero-section">
                        <div class="hero-content">
                            <h1 id="welcomeMessage">Welcome back!</h1>
                            <p id="motivationalQuote" class="hero-quote"></p>
                            <p id="tierDescription" class="tier-description"></p>
                            <p id="daysInRecovery" class="days-recovery"></p>
                        </div>
                        <div class="hero-image"></div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <div class="stat-icon">
                                <i data-lucide="calendar-days"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="streakDays">0</h3>
                                <p>Days in Recovery</p>
                            </div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-icon">
                                <i data-lucide="check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="weeklyCheckins">0/7</h3>
                                <p>Weekly Check-ins</p>
                            </div>
                        </div>
                        <div class="stat-card info">
                            <div class="stat-icon">
                                <i data-lucide="video"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="nextSession">--</h3>
                                <p>Next Session</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h2>Quick Actions</h2>
                        <div class="action-grid">
                            <button onclick="showSection('checkin', this)" class="action-card">
                                <i data-lucide="clipboard-check"></i>
                                <span>Daily Check-in</span>
                            </button>
                            <button onclick="showSection('messages', this)" class="action-card">
                                <i data-lucide="message-circle"></i>
                                <span>Messages</span>
                            </button>
                            <button onclick="showSection('resources', this)" class="action-card">
                                <i data-lucide="book-open"></i>
                                <span>Resources</span>
                            </button>
                            <button onclick="showSection('progress', this)" class="action-card">
                                <i data-lucide="trending-up"></i>
                                <span>Progress</span>
                            </button>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="recent-activity">
                        <h2>Alerts & Updates</h2>
                        <div id="alertsList" class="activity-list">
                            <!-- Activity items will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Check-in Section -->
                <div id="checkinSection" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h1>Daily Check-In</h1>
                        <p>Take a moment to reflect on your day</p>
                    </div>
                    
                    <form id="checkinForm" class="checkin-form" onsubmit="saveCheckin(event); return false;">
                        <div class="form-card">
                            <h3>How are you feeling?</h3>
                            
                            <div class="slider-group">
                                <label>Overall Mood</label>
                                <div class="slider-container">
                                    <input type="range" id="mood" min="1" max="10" value="5" 
                                           oninput="updateSlider('mood')" class="mood-slider">
                                    <div class="slider-labels">
                                        <span>ðŸ˜”</span>
                                        <span class="slider-value" id="moodValue">5</span>
                                        <span>ðŸ˜Š</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="slider-group">
                                <label>Cravings Level</label>
                                <div class="slider-container">
                                    <input type="range" id="cravings" min="1" max="10" value="1" 
                                           oninput="updateSlider('cravings')" class="cravings-slider">
                                    <div class="slider-labels">
                                        <span>Low</span>
                                        <span class="slider-value" id="cravingsValue">1</span>
                                        <span>High</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="slider-group">
                                <label>How Supported Do You Feel?</label>
                                <div class="slider-container">
                                    <input type="range" id="support" min="1" max="10" value="5" 
                                           oninput="updateSlider('support')" class="support-slider">
                                    <div class="slider-labels">
                                        <span>Alone</span>
                                        <span class="slider-value" id="supportValue">5</span>
                                        <span>Supported</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-card">
                            <h3>Daily Details</h3>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Sleep Quality</label>
                                    <select id="sleep" class="form-select">
                                        <option>Excellent</option>
                                        <option>Good</option>
                                        <option selected>Fair</option>
                                        <option>Poor</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Attended Meetings?</label>
                                    <select id="meetings" class="form-select">
                                        <option>Yes</option>
                                        <option>No</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Took Medications?</label>
                                    <select id="medications" class="form-select">
                                        <option>Yes</option>
                                        <option>No</option>
                                        <option>Not Applicable</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-card">
                            <h3>Reflections</h3>
                            
                            <div class="form-group">
                                <label>Today's Win</label>
                                <input type="text" id="dailyWin" placeholder="One positive thing from today..." 
                                       class="form-input">
                            </div>
                            
                            <div class="form-group">
                                <label>Gratitude</label>
                                <input type="text" id="gratitude" placeholder="I'm grateful for..." 
                                       class="form-input">
                            </div>
                            
                            <div class="form-group">
                                <label>Additional Thoughts</label>
                                <textarea id="thoughts" placeholder="How are you feeling today?" 
                                          class="form-textarea" rows="4"></textarea>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <div class="crisis-notice">
                                <i data-lucide="alert-circle"></i>
                                <p>If you're having thoughts of self-harm, please call 988 immediately.</p>
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i data-lucide="save"></i>
                                Save Check-In
                            </button>
                        </div>
                    </form>
                    
                    <div class="recent-checkins">
                        <h3>Your Recent Check-Ins</h3>
                        <div id="recentCheckinsList" class="checkins-list">
                            <!-- Recent check-ins will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Progress Section -->
                <div id="progressSection" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h1>Your Recovery Journey</h1>
                        <button onclick="generateProgressReport()" class="btn btn-secondary">
                            <i data-lucide="download"></i>
                            Download Report
                        </button>
                    </div>
                    
                    <div id="progressContent">
                        <!-- Progress content will be loaded here -->
                    </div>
                </div>
                
                <!-- Connections Section -->
                <div id="connectionsSection" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h1>Peer Connections</h1>
                        <p>Build your recovery support network</p>
                    </div>
                    <div id="connectionsContent">
                        <!-- Connections content will be loaded here -->
                    </div>
                </div>
                
                <!-- Messages Section -->
                <div id="messagesSection" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h1>Messages</h1>
                    </div>
                    <div id="messagesContent">
                        <!-- Messages content will be loaded here -->
                    </div>
                </div>
                
                <!-- Session Tools Section -->
                <div id="sessionsSection" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h1>Session Tools</h1>
                        <p>Assignments and session preparation</p>
                    </div>
                    <div id="sessionContent">
                        <!-- Session content will be loaded here -->
                    </div>
                </div>
                
                <!-- Resources Section -->
                <div id="resourcesSection" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h1>Recovery Resources</h1>
                        <p>Tools and support for your journey</p>
                    </div>
                    
                    <div class="resources-grid">
                        <div class="resource-card emergency">
                            <div class="resource-icon">
                                <i data-lucide="phone"></i>
                            </div>
                            <h3>Crisis Support</h3>
                            <div class="resource-content">
                                <p><strong>988</strong> - Suicide & Crisis Lifeline</p>
                                <p><strong>911</strong> - Medical Emergency</p>
                                <p><strong>1-800-662-4357</strong> - SAMHSA Helpline</p>
                            </div>
                        </div>
                        
                        <div class="resource-card">
                            <div class="resource-icon">
                                <i data-lucide="book"></i>
                            </div>
                            <h3>Recovery Literature</h3>
                            <div class="resource-content">
                                <ul>
                                    <li>The Big Book (AA)</li>
                                    <li>Living Clean (NA)</li>
                                    <li>Recovery Dharma</li>
                                    <li>SMART Recovery Handbook</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="resource-card">
                            <div class="resource-icon">
                                <i data-lucide="heart"></i>
                            </div>
                            <h3>Coping Skills</h3>
                            <div class="resource-content">
                                <ul>
                                    <li>Deep Breathing Exercises</li>
                                    <li>Progressive Muscle Relaxation</li>
                                    <li>Grounding Techniques</li>
                                    <li>Mindfulness Meditation</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="resource-card">
                            <div class="resource-icon">
                                <i data-lucide="map-pin"></i>
                            </div>
                            <h3>Local Resources</h3>
                            <div class="resource-content">
                                <ul>
                                    <li>Bay Area Community Services</li>
                                    <li>LifeRing Service Center</li>
                                    <li>Harm Reduction Coalition</li>
                                    <li>Women's Recovery Association</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Bottom Navigation (Mobile) -->
            <nav class="bottom-nav">
                <button onclick="showSection('dashboard', this)" class="nav-item active" data-section="dashboard">
                    <i data-lucide="home"></i>
                    <span>Home</span>
                </button>
                <button onclick="showSection('checkin', this)" class="nav-item" data-section="checkin">
                    <i data-lucide="clipboard-check"></i>
                    <span>Check-in</span>
                </button>
                <button onclick="showSection('progress', this)" class="nav-item" data-section="progress">
                    <i data-lucide="trending-up"></i>
                    <span>Progress</span>
                </button>
                <button onclick="showSection('connections', this)" class="nav-item" data-section="connections">
                    <i data-lucide="users"></i>
                    <span>Connect</span>
                </button>
                <button onclick="showSection('resources', this)" class="nav-item" data-section="resources">
                    <i data-lucide="book-open"></i>
                    <span>Resources</span>
                </button>
            </nav>
        </div>
        
        <!-- Coach Interface -->
        <div id="coachInterface" class="main-interface hidden">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="top-bar-content">
                    <div class="logo-section">
                        <img src="glrs-logo.png" alt="GLRS Logo" class="header-logo">
                        <span class="app-name">Coach Dashboard</span>
                    </div>
                    <div class="user-section">
                        <span id="coachName" class="user-name"></span>
                        <span class="tier-badge coach">Coach</span>
                        <button onclick="logout()" class="btn btn-ghost btn-sm">
                            <i data-lucide="log-out"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Coach Sidebar -->
            <div class="coach-layout">
                <aside class="coach-sidebar">
                    <nav class="coach-nav">
                        <button onclick="showCoachSection('overview', this)" class="coach-nav-item active">
                            <i data-lucide="layout-dashboard"></i>
                            <span>Overview</span>
                        </button>
                        <button onclick="showCoachSection('createAccount', this)" class="coach-nav-item">
                            <i data-lucide="user-plus"></i>
                            <span>Create PIR Account</span>
                        </button>
                        <button onclick="showCoachSection('checkins', this)" class="coach-nav-item">
                            <i data-lucide="clipboard-list"></i>
                            <span>Review Check-Ins</span>
                        </button>
                        <button onclick="showCoachSection('progress', this)" class="coach-nav-item">
                            <i data-lucide="chart-line"></i>
                            <span>PIR Progress</span>
                        </button>
                        <button onclick="showCoachSection('connections', this)" class="coach-nav-item">
                            <i data-lucide="users"></i>
                            <span>Manage Connections</span>
                        </button>
                        <button onclick="showCoachSection('messages', this)" class="coach-nav-item">
                            <i data-lucide="message-square"></i>
                            <span>Message Center</span>
                        </button>
                        <button onclick="showCoachSection('assignments', this)" class="coach-nav-item">
                            <i data-lucide="file-text"></i>
                            <span>Assignments</span>
                        </button>
                        <button onclick="showCoachSection('resources', this)" class="coach-nav-item">
                            <i data-lucide="folder"></i>
                            <span>Resources</span>
                        </button>
                    </nav>
                </aside>

                <!-- Coach Content Area -->
                <main class="coach-content">
                    <div id="coachContent">
                        <!-- Coach content will be loaded here -->
                    </div>
                </main>
            </div>
        </div>
    </div>
    
    <!-- Firebase scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration and Global Variables -->
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAufSTHtCTFSEIeZ9YzvrULCnji5I-SMi0",
            authDomain: "glrs-pir-system.firebaseapp.com",
            projectId: "glrs-pir-system",
            storageBucket: "glrs-pir-system.firebasestorage.app",
            messagingSenderId: "830378577655",
            appId: "1:830378577655:web:ceb8e57c80f9b1cc028df2"
        };
        
        try {
            firebase.initializeApp(firebaseConfig);
            // Make these global
            window.db = firebase.firestore();
            window.auth = firebase.auth();
        } catch (error) {
            console.error("Firebase initialization error:", error);
            document.getElementById('loadingScreen').style.display = 'none';
            alert("Error connecting to the server. Please refresh the page.");
        }
    </script>
    
    <!-- App JavaScript - MUST come after Firebase initialization -->
    <script src="app.js"></script>
    
    <!-- Helper Functions -->
    <script>
        // Checkbox handler
        function toggleAcceptButton() {
            const checkbox = document.getElementById('agreeCheckbox');
            const acceptBtn = document.getElementById('acceptTerms');
            acceptBtn.disabled = !checkbox.checked;
        }
        
        // Initialize Lucide icons after DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize icons
            if (window.lucide) {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
