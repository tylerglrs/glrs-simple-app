<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GLRS Recovery Connect</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .logo {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .app-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .app-subtitle {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 16px;
        }
        
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .btn-primary {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #f4c430 0%, #ff9500 100%);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .error-message {
            color: #ff6b6b;
            margin-top: 10px;
            font-size: 14px;
        }
        
        /* Main App Container */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            font-size: 20px;
            font-weight: bold;
        }
        
        .notification-badge {
            position: relative;
            cursor: pointer;
        }
        
        .badge-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Content Area */
        .content {
            flex: 1;
            padding: 20px;
            padding-bottom: 80px;
            overflow-y: auto;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 1000;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item.active {
            color: #f4c430;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .nav-label {
            font-size: 12px;
        }
        
        /* Section Content */
        .section-content {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Home Section Styles */
        .hero-background {
            position: relative;
            border-radius: 20px;
            padding: 40px 20px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></svg>');
            background-size: 100px 100px;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            from { transform: translate(0, 0); }
            to { transform: translate(100px, 100px); }
        }
        
        .day-counter-container {
            position: relative;
            z-index: 1;
            text-align: center;
        }
        
        .day-display {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .large-number {
            font-size: 72px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .large-number.milestone-1 { color: #f4c430; }
        .large-number.milestone-7 { color: #ff9500; }
        .large-number.milestone-30 { color: #4caf50; }
        .large-number.milestone-90 { color: #9c27b0; }
        .large-number.milestone-365 { color: #ff6b6b; }
        
        .large-text {
            font-size: 24px;
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .motivational-quote {
            font-size: 16px;
            opacity: 0.8;
            font-style: italic;
        }
        
        .time-blocks {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .time-block {
            text-align: center;
        }
        
        .time-value {
            font-size: 36px;
            font-weight: bold;
        }
        
        .time-label {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .view-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .dot.active {
            width: 24px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .session-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .session-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #f4c430;
        }
        
        .session-details {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .mood-tracker {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .mood-options {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        
        .mood-emoji {
            font-size: 32px;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 10px;
            border-radius: 50%;
        }
        
        .mood-emoji:hover {
            transform: scale(1.2);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .mood-emoji.selected {
            background: rgba(244, 196, 48, 0.3);
            transform: scale(1.2);
        }
        
        .daily-pledge {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.2) 0%, rgba(103, 58, 183, 0.2) 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .pledge-text {
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .btn-primary.completed {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            cursor: default;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #f4c430;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        /* Progress Section Styles */
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            height: 300px;
        }
        
        .milestones-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .milestone-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .milestone-item:last-child {
            border-bottom: none;
        }
        
        .milestone-icon {
            font-size: 24px;
            margin-right: 15px;
        }
        
        .milestone-content {
            flex: 1;
        }
        
        .milestone-title {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .milestone-days {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .milestone-achieved {
            opacity: 0.5;
            text-decoration: line-through;
        }
        
        /* Tasks Section Styles */
        .daily-tasks-card {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(67, 160, 71, 0.1) 100%);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .task-list {
            margin-top: 15px;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-item:hover {
            background: rgba(255, 255, 255, 0.05);
            margin: 0 -10px;
            padding: 12px 10px;
            border-radius: 10px;
        }
        
        .completed {
            color: #4caf50;
            font-weight: bold;
        }
        
        .pending {
            color: #ff9800;
        }
        
        .goal-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .progress-badge {
            background: linear-gradient(135deg, #f4c430 0%, #ff9500 100%);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 10px;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-radius: 10px;
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .assignments-list {
            margin-top: 15px;
        }
        
        .assignment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .btn-complete {
            padding: 5px 15px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
        }
        
        /* Connect Section Styles */
        .chat-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 15px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #f4c430 0%, #ff9500 100%);
        }
        
        .community-chat-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .online-count {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .messages-container {
            height: 400px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .community-message {
            margin-bottom: 15px;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .message-author {
            font-weight: bold;
            color: #f4c430;
        }
        
        .message-time {
            font-size: 12px;
        }
        
        .message-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            word-wrap: break-word;
        }
        
        .empty-chat {
            text-align: center;
            padding: 40px;
            opacity: 0.6;
        }
        
        .chat-input-group {
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 16px;
        }
        
        .send-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #f4c430 0%, #ff9500 100%);
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .topic-rooms-container {
            animation: fadeIn 0.3s ease-in;
        }
        
        .rooms-grid {
            display: grid;
            gap: 15px;
        }
        
        .room-card {
            background: linear-gradient(135deg, rgba(244, 196, 48, 0.1) 0%, rgba(255, 149, 0, 0.1) 100%);
            border: 1px solid rgba(244, 196, 48, 0.3);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .room-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .room-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .room-stats {
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .support-groups-container {
            animation: fadeIn 0.3s ease-in;
        }
        
        .meetings-list {
            display: grid;
            gap: 15px;
        }
        
        .meeting-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .meeting-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .meeting-type {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .meeting-details {
            display: grid;
            gap: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .detail-item {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .join-btn {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-radius: 25px;
            color: white;
            text-decoration: none;
            font-weight: bold;
        }
        
        .emergency-section {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.1) 0%, rgba(255, 99, 72, 0.1) 100%);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 15px;
        }
        
        .emergency-resources {
            margin-bottom: 15px;
        }
        
        .emergency-item {
            margin-bottom: 10px;
        }
        
        .emergency-phone {
            display: inline-block;
            margin-left: 10px;
            color: #ff4757;
            text-decoration: none;
            font-weight: bold;
        }
        
        .sos-btn {
            width: 100%;
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Profile Section Styles */
        .profile-menu {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .profile-header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #f4c430 0%, #ff9500 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-avatar-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .upload-input {
            display: none;
        }
        
        .profile-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .profile-email {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .menu-section {
            margin-top: 20px;
        }
        
        .menu-title {
            font-size: 12px;
            text-transform: uppercase;
            opacity: 0.6;
            margin-bottom: 10px;
            padding: 0 10px;
        }
        
        .menu-item {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            transition: background 0.2s;
            border-radius: 10px;
            text-align: left;
            text-decoration: none;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .menu-item-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .menu-icon {
            font-size: 20px;
        }
        
        .menu-arrow {
            opacity: 0.5;
        }
        
        .btn-danger {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            opacity: 0.6;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .empty-state-text {
            font-size: 16px;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            animation: fadeIn 0.2s ease-in;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-body {
            color: white;
        }
        
        .slider-group {
            margin-bottom: 25px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .slider-value {
            color: #f4c430;
            font-weight: bold;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f4c430;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f4c430;
            cursor: pointer;
        }
        
        .textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 16px;
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-secondary {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        
        .notification-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .notification-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .notification-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .notification-item.unread {
            border-left: 3px solid #f4c430;
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .notification-type {
            font-size: 12px;
            background: rgba(244, 196, 48, 0.3);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .notification-time {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .notification-message {
            font-size: 14px;
            line-height: 1.4;
        }
        
        .notification-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .mark-all-read {
            background: rgba(244, 196, 48, 0.2);
            border: 1px solid rgba(244, 196, 48, 0.5);
            color: white;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .settings-section {
            margin-bottom: 25px;
        }
        
        .settings-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #f4c430;
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .settings-label {
            flex: 1;
        }
        
        .time-input {
            padding: 8px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 14px;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: #4caf50;
        }
        
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }
        
        .emergency-contacts-list {
            margin-bottom: 20px;
        }
        
        .contact-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .contact-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .contact-phone {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .contact-relationship {
            font-size: 12px;
            opacity: 0.6;
        }
        
        .add-contact-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
        }
        
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .export-option {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .export-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .export-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .export-description {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .broadcast-banner {
            background: linear-gradient(135deg, rgba(244, 196, 48, 0.2) 0%, rgba(255, 149, 0, 0.2) 100%);
            border: 1px solid rgba(244, 196, 48, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .milestone-preview {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(67, 160, 71, 0.1) 100%);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            margin-top: 20px;
        }
        
        .group-chat-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
        }
        
        .group-info {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .group-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .group-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .group-description {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .group-messages {
            height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .group-message {
            margin-bottom: 15px;
        }
        
        .message-sender {
            font-weight: bold;
            color: #f4c430;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .message-bubble {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
            max-width: 80%;
        }
        
        .message-timestamp {
            font-size: 11px;
            opacity: 0.6;
            margin-top: 5px;
        }
        
        .crisis-resources {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 15px;
        }
        
        .crisis-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ff4757;
        }
        
        .crisis-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .crisis-number a {
            color: white;
            text-decoration: none;
        }
        
        .crisis-description {
            font-size: 14px;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .large-number {
                font-size: 56px;
            }
            
            .modal-content {
                padding: 20px;
            }
        }
        
        /* Loading Spinner */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #f4c430;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React and Firebase -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="text/babel">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAufSTHtCTFSEIeZ9YzvrULCnji5I-SMi0",
            authDomain: "glrs-pir-system.firebaseapp.com",
            projectId: "glrs-pir-system",
            storageBucket: "glrs-pir-system.appspot.com",
            messagingSenderId: "830378577655",
            appId: "1:830378577655:web:8a9ea644b8e3c5a9f15c42"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        const { useState, useEffect, useRef } = React;

        // Main App Component
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setLoading(false);
                });

                return unsubscribe;
            }, []);

            if (loading) {
                return (
                    <div className="loading-container">
                        <div className="loading-spinner"></div>
                    </div>
                );
            }

            return user ? <PIRApp user={user} /> : <LoginScreen />;
        }

        // Login Screen Component
        function LoginScreen() {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="login-container">
                    <div className="login-card">
                        <div className="logo">üè†</div>
                        <h1 className="app-title">GLRS Recovery</h1>
                        <p className="app-subtitle">Your Journey, Your Strength</p>
                        
                        <form onSubmit={handleLogin}>
                            <div className="form-group">
                                <label className="form-label">Email</label>
                                <input
                                    type="email"
                                    className="form-input"
                                    placeholder="Enter your email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Password</label>
                                <input
                                    type="password"
                                    className="form-input"
                                    placeholder="Enter your password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <button type="submit" className="btn-primary" disabled={loading}>
                                {loading ? 'Signing in...' : 'Sign In'}
                            </button>
                            
                            {error && <div className="error-message">{error}</div>}
                        </form>
                    </div>
                </div>
            );
        }

        // Main PIR App Component
        function PIRApp({ user }) {
            // Navigation State
            const [currentView, setCurrentView] = useState('home');
            const [loading, setLoading] = useState(true);
            
            // User Data States
            const [userData, setUserData] = useState(null);
            const [profileImage, setProfileImage] = useState(null);
            const [coachInfo, setCoachInfo] = useState(null);
            
            // Home Section States
            const [sobrietyDays, setSobrietyDays] = useState(0);
            const [dayCounterView, setDayCounterView] = useState(0);
            const [timeBreakdown, setTimeBreakdown] = useState({ years: 0, months: 0, days: 0 });
            const [selectedMood, setSelectedMood] = useState(null);
            const [pledgeMade, setPledgeMade] = useState(false);
            const [moneySaved, setMoneySaved] = useState(0);
            const [avgMoodDisplay, setAvgMoodDisplay] = useState(0);
            const [currentStreak, setCurrentStreak] = useState(0);
            const [daysUntilMilestone, setDaysUntilMilestone] = useState(0);
            const [assignmentsCompleted, setAssignmentsCompleted] = useState(0);
            const [lastCheckInTime, setLastCheckInTime] = useState('Never');
            const [checkInStatus, setCheckInStatus] = useState({ morning: false, evening: false });
            const [dailyQuote, setDailyQuote] = useState(null);
            const [milestones, setMilestones] = useState([]);
            const [nextMilestone, setNextMilestone] = useState(null);
            const [activeBroadcast, setActiveBroadcast] = useState(null);
            const [nextSession, setNextSession] = useState(null);
            
            // Progress Section States
            const [progressMilestones, setProgressMilestones] = useState([]);
            const [moodChartData, setMoodChartData] = useState(null);
            const [cravingChartData, setCravingChartData] = useState(null);
            
            // Tasks Section States
            const [goals, setGoals] = useState([]);
            const [assignments, setAssignments] = useState([]);
            
            // Connect Section States
            const [activeChat, setActiveChat] = useState('main');
            const [communityMessages, setCommunityMessages] = useState([]);
            const [communityMessage, setCommunityMessage] = useState('');
            const [topicRooms, setTopicRooms] = useState([]);
            const [meetings, setMeetings] = useState([]);
            const [emergencyResources, setEmergencyResources] = useState([]);
            const [onlineUsers, setOnlineUsers] = useState(0);
            const [groupMessages, setGroupMessages] = useState([]);
            const [supportGroups, setSupportGroups] = useState([]);
            const [activeTopicRoom, setActiveTopicRoom] = useState(null);
            
            // Profile Section States
            const [resources, setResources] = useState({
                videos: [],
                articles: [],
                tools: [],
                worksheets: []
            });
            
            // General States
            const [notifications, setNotifications] = useState([]);
            const [unreadCount, setUnreadCount] = useState(0);
            const [checkIns, setCheckIns] = useState([]);
            const [showModal, setShowModal] = useState(null);
            const [touchStart, setTouchStart] = useState(0);
            const fileInputRef = useRef(null);
            
            // Load User Data
            useEffect(() => {
                if (user) {
                    loadUserData();
                    loadTopicRooms();
                    loadMeetings();
                    loadEmergencyResources();
                    loadGroupMessages('main');
                    loadGoals();
                    loadAssignments();
                    loadDailyInspiration();
                    loadMilestones();
                    loadBroadcasts();
                    loadResources();
                }
            }, [user]);
            
            // Subscribe to real-time updates
            useEffect(() => {
                if (user) {
                    const unsubscribeList = [];
                    
                    // Subscribe to notifications
                    const notificationsUnsubscribe = db.collection('notifications')
                        .where('userId', '==', user.uid)
                        .orderBy('createdAt', 'desc')
                        .onSnapshot(snapshot => {
                            const notificationsList = [];
                            let unread = 0;
                            snapshot.forEach(doc => {
                                const notification = { id: doc.id, ...doc.data() };
                                notificationsList.push(notification);
                                if (!notification.read) unread++;
                            });
                            setNotifications(notificationsList);
                            setUnreadCount(unread);
                        });
                    unsubscribeList.push(notificationsUnsubscribe);
                    
                    // Subscribe to assignments
                    const assignmentsUnsubscribe = db.collection('assignments')
                        .where('userId', '==', user.uid)
                        .onSnapshot(snapshot => {
                            loadAssignments();
                        });
                    unsubscribeList.push(assignmentsUnsubscribe);
                    
                    // Subscribe to goals
                    const goalsUnsubscribe = db.collection('goals')
                        .where('userId', '==', user.uid)
                        .where('status', '==', 'active')
                        .onSnapshot(snapshot => {
                            loadGoals();
                        });
                    unsubscribeList.push(goalsUnsubscribe);
                    
                    return () => {
                        unsubscribeList.forEach(unsubscribe => unsubscribe());
                    };
                }
            }, [user]);
              // Initialize Charts
        useEffect(() => {
            const initCharts = () => {
                const moodCanvas = document.getElementById('moodChart');
                const cravingCanvas = document.getElementById('cravingChart');
                
                if (moodCanvas && window.moodChartData) {
                    const ctx = moodCanvas.getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: window.moodChartData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 5
                                }
                            }
                        }
                    });
                }
                
                if (cravingCanvas && window.cravingChartData) {
                    const ctx = cravingCanvas.getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: window.cravingChartData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 5
                                }
                            }
                        }
                    });
                }
            };
            
            // Delay to ensure data is loaded
            setTimeout(initCharts, 100);
        }, []);
            
            // Calculate sobriety days and related metrics
            useEffect(() => {
                if (userData?.sobrietyDate) {
                    const calculateDays = () => {
                        const sobrietyDate = userData.sobrietyDate.toDate ? 
                            userData.sobrietyDate.toDate() : new Date(userData.sobrietyDate);
                        const today = new Date();
                        const diffTime = Math.abs(today - sobrietyDate);
                        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                        setSobrietyDays(diffDays);
                        
                        // Calculate time breakdown
                        const years = Math.floor(diffDays / 365);
                        const months = Math.floor((diffDays % 365) / 30);
                        const days = diffDays % 30;
                        setTimeBreakdown({ years, months, days });
                        
                        // Calculate money saved ($20/day)
                        setMoneySaved(diffDays * 20);
                        
                        // Update milestone countdown
                        if (nextMilestone) {
                            setDaysUntilMilestone(nextMilestone.daysRequired - diffDays);
                        }
                    };
                    
                    calculateDays();
                    const interval = setInterval(calculateDays, 60000); // Update every minute
                    
                    return () => clearInterval(interval);
                }
            }, [userData, nextMilestone]);
            
            // Update last check-in time
            useEffect(() => {
                const updateCheckInTime = () => {
                    if (checkIns && checkIns.length > 0) {
                        const lastCheckIn = checkIns[0];
                        if (lastCheckIn) {
                            const checkInDate = lastCheckIn.createdAt?.toDate ? 
                                lastCheckIn.createdAt.toDate() : new Date(lastCheckIn.createdAt);
                            const timeDiff = Date.now() - checkInDate.getTime();
                            const hours = Math.floor(timeDiff / (1000 * 60 * 60));
                            
                            if (hours === 0) {
                                setLastCheckInTime('Now');
                            } else if (hours === 1) {
                                setLastCheckInTime('1hr ago');
                            } else if (hours < 24) {
                                setLastCheckInTime(`${hours}hrs ago`);
                            } else {
                                const days = Math.floor(hours / 24);
                                setLastCheckInTime(`${days}d ago`);
                            }
                        }
                    } else {
                        setLastCheckInTime('Never');
                    }
                };
                
                updateCheckInTime();
                const interval = setInterval(updateCheckInTime, 60000);
                
                return () => clearInterval(interval);
            }, [checkIns]);
            
            // Load user data from Firestore
            const loadUserData = async () => {
                try {
                    setLoading(true);
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    
                    if (userDoc.exists) {
                        const data = userDoc.data();
                        setUserData(data);
                        
                        if (data.profileImageUrl) {
                            setProfileImage(data.profileImageUrl);
                        }
                        
                        // Load coach info if assigned
                        if (data.assignedCoach) {
                            const coachDoc = await db.collection('users').doc(data.assignedCoach).get();
                            if (coachDoc.exists) {
                                setCoachInfo(coachDoc.data());
                            }
                        }
                        
                        // Load check-ins
                        loadCheckIns(user.uid);
                        
                        // Load support groups
                        loadSupportGroups(user.uid);
                        
                        // Load next session
                        loadNextSession(user.uid);
                        
                        // Load streak
                        loadCheckInStreak(user.uid);
                        
                        // Load today's pledge
                        loadTodaysPledge(user.uid);
                        
                        // Load notifications
                        loadNotifications(user.uid);
                    } else {
                        // Create new user document if doesn't exist
                        await createNewUser(user.uid, user.email);
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            // Create new user document
            const createNewUser = async (uid, email) => {
                try {
                    const newUserData = {
                        email: email,
                        role: 'pir',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        sobrietyDate: new Date(),
                        active: true
                    };
                    
                    await db.collection('users').doc(uid).set(newUserData);
                    setUserData(newUserData);
                } catch (error) {
                    console.error('Error creating user:', error);
                }
            };
            
            // Load topic rooms from Firestore
            const loadTopicRooms = async () => {
                try {
                    const roomsSnap = await db.collection('topicRooms')
                        .where('active', '==', true)
                        .get();
                    
                    const roomsData = [];
                    roomsSnap.forEach(doc => {
                        roomsData.push({ id: doc.id, ...doc.data() });
                    });
                    setTopicRooms(roomsData);
                } catch (error) {
                    console.error('Error loading topic rooms:', error);
                    setTopicRooms([]);
                }
            };
            
            // Load meetings from admin
            const loadMeetings = async () => {
                try {
                    const meetingsSnap = await db.collection('meetings')
                        .where('active', '==', true)
                        .get();
                    
                    const meetingsData = [];
                    meetingsSnap.forEach(doc => {
                        meetingsData.push({ id: doc.id, ...doc.data() });
                    });
                    setMeetings(meetingsData);
                } catch (error) {
                    console.error('Error loading meetings:', error);
                    setMeetings([]);
                }
            };
            
            // Load emergency resources
            const loadEmergencyResources = async () => {
                try {
                    const emergencySnap = await db.collection('resources')
                        .where('category', '==', 'emergency')
                        .where('active', '==', true)
                        .get();
                    
                    const emergencyData = [];
                    emergencySnap.forEach(doc => {
                        emergencyData.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Sort by priority if available
                    emergencyData.sort((a, b) => (a.priority || 999) - (b.priority || 999));
                    setEmergencyResources(emergencyData);
                } catch (error) {
                    console.error('Error loading emergency resources:', error);
                    setEmergencyResources([]);
                }
            };
            
            // Load goals assigned by admin
            const loadGoals = async () => {
                try {
                    const goalsSnap = await db.collection('goals')
                        .where('userId', '==', user.uid)
                        .where('status', '==', 'active')
                        .get();
                    
                    const goalsData = [];
                    for (const doc of goalsSnap.docs) {
                        const goalData = { id: doc.id, ...doc.data() };
                        
                        // Load assignments for this goal
                        const assignmentsSnap = await db.collection('assignments')
                            .where('goalId', '==', doc.id)
                            .where('userId', '==', user.uid)
                            .get();
                        
                        const assignments = [];
                        assignmentsSnap.forEach(aDoc => {
                            assignments.push({ id: aDoc.id, ...aDoc.data() });
                        });
                        
                        goalData.assignments = assignments;
                        goalsData.push(goalData);
                    }
                    
                    setGoals(goalsData);
                } catch (error) {
                    console.error('Error loading goals:', error);
                    setGoals([]);
                }
            };
            
            // Load standalone assignments
            const loadAssignments = async () => {
                try {
                    const assignmentsSnap = await db.collection('assignments')
                        .where('userId', '==', user.uid)
                        .where('goalId', '==', null)
                        .get();
                    
                    const assignmentsData = [];
                    let completed = 0;
                    assignmentsSnap.forEach(doc => {
                        const assignment = { id: doc.id, ...doc.data() };
                        assignmentsData.push(assignment);
                        if (assignment.status === 'completed') completed++;
                    });
                    
                    setAssignments(assignmentsData);
                    setAssignmentsCompleted(completed);
                } catch (error) {
                    console.error('Error loading assignments:', error);
                    setAssignments([]);
                }
            };
            
            // Load daily inspiration from admin
            const loadDailyInspiration = async () => {
                try {
                    const inspirationsSnap = await db.collection('dailyInspirations')
                        .where('active', '==', true)
                        .get();
                    
                    if (!inspirationsSnap.empty) {
                        const inspirations = [];
                        inspirationsSnap.forEach(doc => {
                            inspirations.push({ id: doc.id, ...doc.data() });
                        });
                        
                        const randomIndex = Math.floor(Math.random() * inspirations.length);
                        setDailyQuote(inspirations[randomIndex]);
                    } else {
                        setDailyQuote({
                            quote: "One day at a time.",
                            author: "Recovery Wisdom"
                        });
                    }
                } catch (error) {
                    console.error('Error loading inspiration:', error);
                    setDailyQuote({
                        quote: "Progress, not perfection.",
                        author: "Recovery Wisdom"
                    });
                }
            };
            
            // Load milestones from admin
            const loadMilestones = async () => {
                try {
                    const milestonesSnap = await db.collection('milestones')
                        .orderBy('daysRequired', 'asc')
                        .get();
                    
                    const milestonesData = [];
                    milestonesSnap.forEach(doc => {
                        milestonesData.push({ id: doc.id, ...doc.data() });
                    });
                    setMilestones(milestonesData);
                    
                    // Calculate next milestone
                    if (userData?.sobrietyDate) {
                        const daysClean = Math.floor((new Date() - new Date(userData.sobrietyDate)) / (1000 * 60 * 60 * 24));
                        const nextMilestone = milestonesData.find(m => m.daysRequired > daysClean);
                        setNextMilestone(nextMilestone);
                    }
                } catch (error) {
                    console.error('Error loading milestones:', error);
                }
            };
            
            // Load broadcasts from admin
            const loadBroadcasts = async () => {
                try {
                    const broadcastsSnap = await db.collection('broadcasts')
                        .where('active', '==', true)
                        .orderBy('createdAt', 'desc')
                        .limit(1)
                        .get();
                    
                    if (!broadcastsSnap.empty) {
                        const broadcast = broadcastsSnap.docs[0].data();
                        setActiveBroadcast(broadcast);
                    }
                } catch (error) {
                    console.error('Error loading broadcasts:', error);
                }
            };
            
            // Load resources from admin
            const loadResources = async () => {
                try {
                    const resourcesSnap = await db.collection('resources')
                        .where('active', '==', true)
                        .where('category', '!=', 'emergency')
                        .get();
                    
                    const resourcesData = {
                        videos: [],
                        articles: [],
                        tools: [],
                        worksheets: []
                    };
                    
                    resourcesSnap.forEach(doc => {
                        const resource = { id: doc.id, ...doc.data() };
                        
                        // Categorize resources
                        if (resource.category === 'video') {
                            resourcesData.videos.push(resource);
                        } else if (resource.category === 'article') {
                            resourcesData.articles.push(resource);
                        } else if (resource.category === 'tool') {
                            resourcesData.tools.push(resource);
                        } else if (resource.category === 'worksheet') {
                            resourcesData.worksheets.push(resource);
                        }
                        
                        // Track view count
                        if (resource.featured) {
                            resource.priority = 1;
                        }
                    });
                    
                    // Sort by priority (featured first) and then by title
                    Object.keys(resourcesData).forEach(key => {
                        resourcesData[key].sort((a, b) => {
                            if (a.priority && !b.priority) return -1;
                            if (!a.priority && b.priority) return 1;
                            return a.title.localeCompare(b.title);
                        });
                    });
                    
                    setResources(resourcesData);
                } catch (error) {
                    console.error('Error loading resources:', error);
                    setResources({
                        videos: [],
                        articles: [],
                        tools: [],
                        worksheets: []
                    });
                }
            };
            
            // Load check-ins
            const loadCheckIns = async (uid) => {
                try {
                    const checkInsSnapshot = await db.collection('checkIns')
                        .where('userId', '==', uid)
                        .orderBy('createdAt', 'desc')
                        .limit(7)
                        .get();
                    
                    const checkInsList = [];
                    checkInsSnapshot.forEach(doc => {
                        checkInsList.push({ id: doc.id, ...doc.data() });
                    });
                    setCheckIns(checkInsList);
                    
                    // Calculate average mood
                    if (checkInsList.length > 0) {
                        const totalMood = checkInsList.reduce((sum, checkIn) => 
                            sum + (checkIn.morningData?.mood || 0), 0);
                        const avgMood = Math.round((totalMood / checkInsList.length) * 2);
                        setAvgMoodDisplay(avgMood);
                    }
                    
                    // Check today's check-in status
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    const todayCheckIn = checkInsList.find(checkIn => {
                        const checkInDate = checkIn.createdAt?.toDate ? 
                            checkIn.createdAt.toDate() : new Date(checkIn.createdAt);
                        checkInDate.setHours(0, 0, 0, 0);
                        return checkInDate.getTime() === today.getTime();
                    });
                    
                    if (todayCheckIn) {
                        setCheckInStatus({
                            morning: !!todayCheckIn.morningData,
                            evening: !!todayCheckIn.eveningData
                        });
                    }
                    
                    // Prepare chart data
                    prepareChartData(checkInsList);
                } catch (error) {
                    console.error('Error loading check-ins:', error);
                }
            };
            
            // Prepare chart data for progress section
            const prepareChartData = (checkInsList) => {
                const labels = [];
                const moodData = [];
                const cravingData = [];
                
                // Get last 7 days
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                    labels.push(dayName);
                    
                    // Find check-in for this date
                    const checkIn = checkInsList.find(c => {
                        const checkInDate = c.createdAt?.toDate ? 
                            c.createdAt.toDate() : new Date(c.createdAt);
                        return checkInDate.toDateString() === date.toDateString();
                    });
                    
                    if (checkIn) {
                        moodData.push(checkIn.morningData?.mood || 0);
                        cravingData.push(checkIn.morningData?.craving || 0);
                    } else {
                        moodData.push(0);
                        cravingData.push(0);
                    }
                }
                
                setMoodChartData({
                    labels: labels,
                    datasets: [{
                        label: 'Mood',
                        data: moodData,
                        borderColor: '#4caf50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4
                    }]
                });
                
                setCravingChartData({
                    labels: labels,
                    datasets: [{
                        label: 'Cravings',
                        data: cravingData,
                        borderColor: '#ff9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.1)',
                        tension: 0.4
                    }]
                });
            };
            
            // Load support groups
            const loadSupportGroups = async (uid) => {
                try {
                    const snapshot = await db.collection('supportGroups')
                        .where('assignedPIRs', 'array-contains', uid)
                        .where('active', '==', true)
                        .get();
                    
                    const groupsList = [];
                    snapshot.forEach(doc => {
                        groupsList.push({ id: doc.id, ...doc.data() });
                    });
                    setSupportGroups(groupsList);
                } catch (error) {
                    console.error('Error loading support groups:', error);
                }
            };
            
            // Load next session
            const loadNextSession = async (uid) => {
                try {
                    const sessionsSnapshot = await db.collection('sessions')
                        .where('pirId', '==', uid)
                        .where('status', '==', 'scheduled')
                        .orderBy('scheduledDate', 'asc')
                        .limit(1)
                        .get();
                    
                    if (!sessionsSnapshot.empty) {
                        const session = sessionsSnapshot.docs[0].data();
                        setNextSession(session);
                    }
                } catch (error) {
                    console.error('Error loading next session:', error);
                }
            };
            
            // Load check-in streak
            const loadCheckInStreak = async (uid) => {
                try {
                    const streakDoc = await db.collection('streaks').doc(uid).get();
                    if (streakDoc.exists) {
                        setCurrentStreak(streakDoc.data().currentStreak || 0);
                    }
                } catch (error) {
                    console.error('Error loading streak:', error);
                }
            };
            
            // Load today's pledge
            const loadTodaysPledge = async (uid) => {
                try {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    const pledgeSnapshot = await db.collection('pledges')
                        .where('userId', '==', uid)
                        .where('date', '>=', today)
                        .get();
                    
                    setPledgeMade(!pledgeSnapshot.empty);
                } catch (error) {
                    console.error('Error loading pledge:', error);
                }
            };
            
            // Load notifications
            const loadNotifications = async (uid) => {
                try {
                    const notificationsSnapshot = await db.collection('notifications')
                        .where('userId', '==', uid)
                        .orderBy('createdAt', 'desc')
                        .limit(20)
                        .get();
                    
                    const notificationsList = [];
                    let unread = 0;
                    notificationsSnapshot.forEach(doc => {
                        const notification = { id: doc.id, ...doc.data() };
                        notificationsList.push(notification);
                        if (!notification.read) unread++;
                    });
                    
                    setNotifications(notificationsList);
                    setUnreadCount(unread);
                } catch (error) {
                    console.error('Error loading notifications:', error);
                }
            };
            
            // Load group messages
            const loadGroupMessages = async (groupId) => {
                try {
                    const snapshot = await db.collection('messages')
                        .where(groupId === 'main' ? 'roomId' : 'groupId', '==', groupId)
                        .orderBy('createdAt', 'desc')
                        .limit(50)
                        .get();
                    
                    const messagesList = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        messagesList.push({
                            id: doc.id,
                            ...data,
                            createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date()
                        });
                    });
                    
                    if (groupId === 'main') {
                        setCommunityMessages(messagesList.reverse());
                    } else {
                        setGroupMessages(messagesList.reverse());
                    }
                } catch (error) {
                    console.error('Error loading messages:', error);
                }
            };
            
            // Send community message
            const sendCommunityMessage = async (content) => {
                if (!content || !content.trim()) return;
                
                try {
                    await db.collection('messages').add({
                        roomId: 'main',
                        userId: user.uid,
                        senderName: userData?.displayName || 'Anonymous',
                        content: content,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        flagged: false,
                        edited: false
                    });
                    
                    // Reload messages
                    loadGroupMessages('main');
                } catch (error) {
                    console.error('Error sending message:', error);
                }
            };
            
            // Update goal progress
            const updateGoalProgress = async (goalId) => {
                try {
                    const assignmentsSnap = await db.collection('assignments')
                        .where('goalId', '==', goalId)
                        .where('userId', '==', user.uid)
                        .get();
                    
                    let total = 0;
                    let completed = 0;
                    
                    assignmentsSnap.forEach(doc => {
                        total++;
                        if (doc.data().status === 'completed') {
                            completed++;
                        }
                    });
                    
                    const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                    
                    await db.collection('goals').doc(goalId).update({
                        progress: progress,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    loadGoals();
                } catch (error) {
                    console.error('Error updating goal progress:', error);
                }
            };
            
            // Complete assignment
            const completeAssignment = async (assignmentId, goalId) => {
                try {
                    await db.collection('assignments').doc(assignmentId).update({
                        status: 'completed',
                        completedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Create notification
                    await createNotification(
                        'assignment',
                        'Assignment Completed',
                        'Great job completing your assignment!'
                    );
                    
                    if (goalId) {
                        await updateGoalProgress(goalId);
                    }
                    
                    loadAssignments();
                    loadGoals();
                } catch (error) {
                    console.error('Error completing assignment:', error);
                }
            };
            
            // Handle mood selection
            const handleMoodSelect = (mood) => {
                setSelectedMood(mood);
            };
            
            // Handle daily pledge
            const handlePledge = async () => {
                if (pledgeMade) return;
                
                try {
                    await db.collection('pledges').add({
                        userId: user.uid,
                        date: new Date(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    setPledgeMade(true);
                    
                    await createNotification(
                        'pledge',
                        'Daily Pledge Made',
                        'You\'ve committed to your recovery today!'
                    );
                } catch (error) {
                    console.error('Error making pledge:', error);
                }
            };
            
            // Create notification
            const createNotification = async (type, title, message) => {
                try {
                    await db.collection('notifications').add({
                        userId: user.uid,
                        type: type,
                        title: title,
                        message: message,
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.error('Error creating notification:', error);
                }
            };
            
            // Handle morning check-in
            const handleMorningCheckIn = async (data) => {
                try {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    // Check if check-in already exists for today
                    const existingCheckIn = await db.collection('checkIns')
                        .where('userId', '==', user.uid)
                        .where('date', '>=', today)
                        .get();
                    
                    if (existingCheckIn.empty) {
                        // Create new check-in
                        await db.collection('checkIns').add({
                            userId: user.uid,
                            date: new Date(),
                            morningData: data,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } else {
                        // Update existing check-in
                        await db.collection('checkIns').doc(existingCheckIn.docs[0].id).update({
                            morningData: data,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    
                    setCheckInStatus(prev => ({ ...prev, morning: true }));
                    
                    await createNotification(
                        'check-in',
                        'Morning Check-in Complete',
                        'Great start to your day!'
                    );
                    
                    loadCheckIns(user.uid);
                } catch (error) {
                    console.error('Error with morning check-in:', error);
                }
            };
            
            // Handle evening reflection
            const handleEveningReflection = async (data) => {
                try {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    const existingCheckIn = await db.collection('checkIns')
                        .where('userId', '==', user.uid)
                        .where('date', '>=', today)
                        .get();
                    
                    if (existingCheckIn.empty) {
                        await db.collection('checkIns').add({
                            userId: user.uid,
                            date: new Date(),
                            eveningData: data,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } else {
                        await db.collection('checkIns').doc(existingCheckIn.docs[0].id).update({
                            eveningData: data,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    
                    setCheckInStatus(prev => ({ ...prev, evening: true }));
                    
                    await createNotification(
                        'check-in',
                        'Evening Reflection Complete',
                        'Rest well, you\'ve earned it!'
                    );
                    
                    loadCheckIns(user.uid);
                } catch (error) {
                    console.error('Error with evening reflection:', error);
                }
            };
            
            // Handle SOS trigger
            const triggerSOS = async () => {
                if (confirm('This will send an emergency alert. Continue?')) {
                    try {
                        await db.collection('alerts').add({
                            userId: user.uid,
                            type: 'sos',
                            status: 'active',
                            message: 'Emergency SOS triggered',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        alert('Emergency alert sent. Help is on the way.');
                    } catch (error) {
                        console.error('Error triggering SOS:', error);
                        alert('Failed to send alert. Please call 988 for immediate help.');
                    }
                }
            };
            
            // Handle profile image upload
            const handleProfileImageUpload = async (file) => {
                try {
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                        const base64String = reader.result;
                        
                        await db.collection('users').doc(user.uid).update({
                            profileImageUrl: base64String
                        });
                        
                        setProfileImage(base64String);
                        
                        await createNotification(
                            'profile',
                            'Profile Updated',
                            'Your profile picture has been updated'
                        );
                    };
                    reader.readAsDataURL(file);
                } catch (error) {
                    console.error('Error uploading image:', error);
                }
            };
            
            // Handle logout
            const handleLogout = async () => {
                if (confirm('Are you sure you want to sign out?')) {
                    await auth.signOut();
                }
            };
            
            // Mark notification as read
            const markNotificationAsRead = async (notificationId) => {
                try {
                    await db.collection('notifications').doc(notificationId).update({
                        read: true,
                        readAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    loadNotifications(user.uid);
                } catch (error) {
                    console.error('Error marking notification as read:', error);
                }
            };
            
            // Mark all notifications as read
            const markAllNotificationsAsRead = async () => {
                try {
                    const batch = db.batch();
                    
                    notifications.forEach(notification => {
                        if (!notification.read) {
                            const notificationRef = db.collection('notifications').doc(notification.id);
                            batch.update(notificationRef, {
                                read: true,
                                readAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    });
                    
                    await batch.commit();
                    loadNotifications(user.uid);
                } catch (error) {
                    console.error('Error marking all as read:', error);
                }
            };
            
            // Handle touch events for day counter swipe
            const handleTouchStart = (e) => {
                setTouchStart(e.targetTouches[0].clientX);
            };
            
            const handleTouchEnd = (e) => {
                if (!touchStart) return;
                
                const touchEnd = e.changedTouches[0].clientX;
                const diff = touchStart - touchEnd;
                
                if (Math.abs(diff) > 50) {
                    if (diff > 0 && dayCounterView < 2) {
                        setDayCounterView(dayCounterView + 1);
                    } else if (diff < 0 && dayCounterView > 0) {
                        setDayCounterView(dayCounterView - 1);
                    }
                }
            };
            
            // Get day counter class for milestone colors
            const getDayCounterClass = (days) => {
                if (days >= 365) return 'milestone-365';
                if (days >= 90) return 'milestone-90';
                if (days >= 30) return 'milestone-30';
                if (days >= 7) return 'milestone-7';
                if (days >= 1) return 'milestone-1';
                return '';
            };
            
            // Format time ago
            const formatTimeAgo = (date) => {
                if (!date) return 'Unknown';
                
                const messageDate = date.toDate ? date.toDate() : new Date(date);
                const now = new Date();
                const diffInSeconds = Math.floor((now - messageDate) / 1000);
                
                if (diffInSeconds < 60) return 'just now';
                if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
                if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
                if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)}d ago`;
                
                return messageDate.toLocaleDateString();
            };
            
            // Format date
            const formatDate = (date) => {
                if (!date) return '';
                const d = date.toDate ? date.toDate() : new Date(date);
                return d.toLocaleDateString();
            };
            
            // Enter topic room
            const enterTopicRoom = (room) => {
                setActiveTopicRoom(room);
                loadGroupMessages(room.id);
                setShowModal('topicRoom');
            };
            
            // Send group message
            const sendGroupMessage = async (groupId, content) => {
                if (!content || !content.trim()) return;
                
                try {
                    await db.collection('messages').add({
                        groupId: groupId,
                        userId: user.uid,
                        senderName: userData?.displayName || 'Anonymous',
                        content: content,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    loadGroupMessages(groupId);
                } catch (error) {
                    console.error('Error sending group message:', error);
                }
            };
            
            // Export data functions
            const exportDataAsJSON = () => {
                const exportData = {
                    userData: userData,
                    checkIns: checkIns,
                    goals: goals,
                    assignments: assignments,
                    sobrietyDays: sobrietyDays,
                    exportedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `recovery_data_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            };
            
            const exportDataAsPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.text('Recovery Progress Report', 20, 20);
                
                doc.setFontSize(12);
                doc.text(`Name: ${userData?.displayName || user.email}`, 20, 40);
                doc.text(`Days Clean: ${sobrietyDays}`, 20, 50);
                doc.text(`Money Saved: $${moneySaved.toLocaleString()}`, 20, 60);
                doc.text(`Check-in Streak: ${currentStreak} days`, 20, 70);
                doc.text(`Export Date: ${new Date().toLocaleDateString()}`, 20, 80);
                
                doc.save(`recovery_report_${new Date().toISOString().split('T')[0]}.pdf`);
            };
            
            if (loading) {
                return (
                    <div className="loading-container">
                        <div className="loading-spinner"></div>
                    </div>
                );
            }
            
            return (
                <div className="app-container">
                    <div className="header">
                        <div className="header-title">
                            üè† GLRS Recovery
                        </div>
                        <div 
                            className="notification-badge"
                            onClick={() => setShowModal('notifications')}
                        >
                            <span style={{fontSize: '24px'}}>üîî</span>
                            {unreadCount > 0 && (
                                <span className="badge-count">{unreadCount}</span>
                            )}
                        </div>
                    </div>
                    
                    <div className="content">
                        {currentView === 'home' && (
                            <>
                                {activeBroadcast && (
                                    <div className="broadcast-banner">
                                        <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                                            <span style={{fontSize: '20px'}}>üì¢</span>
                                            <div>
                                                <div style={{fontWeight: 'bold', color: '#f4c430'}}>Announcement</div>
                                                <div style={{color: 'white', marginTop: '5px'}}>{activeBroadcast.message}</div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div 
                                    className="hero-background"
                                    style={{ background: 'linear-gradient(135deg, rgba(102, 126, 234, 0.5) 0%, rgba(118, 75, 162, 0.5) 100%)' }}
                                >
                                    <div className="hero-overlay"></div>
                                    <div 
                                        className="day-counter-container"
                                        onTouchStart={handleTouchStart}
                                        onTouchEnd={handleTouchEnd}
                                    >
                                        {dayCounterView === 0 && (
                                            <div className="day-display">
                                                <div className={`large-number ${getDayCounterClass(sobrietyDays)}`}>
                                                    {sobrietyDays}
                                                </div>
                                                <div className="large-text">Days Strong</div>
                                                <div className="motivational-quote">
                                                    {dailyQuote?.quote || "One day at a time, one lighthouse beam at a time."}
                                                </div>
                                                {dailyQuote?.author && (
                                                    <div style={{fontSize: '12px', opacity: 0.7, marginTop: '5px'}}>
                                                        ‚Äî {dailyQuote.author}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        
                                        {dayCounterView === 1 && (
                                            <div className="day-display">
                                                <div className="time-blocks">
                                                    {timeBreakdown.years > 0 && (
                                                        <div className="time-block">
                                                            <div className="time-value">{timeBreakdown.years}</div>
                                                            <div className="time-label">Years</div>
                                                        </div>
                                                    )}
                                                    {timeBreakdown.months > 0 && (
                                                        <div className="time-block">
                                                            <div className="time-value">{timeBreakdown.months}</div>
                                                            <div className="time-label">Months</div>
                                                        </div>
                                                    )}
                                                    <div className="time-block">
                                                        <div className="time-value">{timeBreakdown.days}</div>
                                                        <div className="time-label">Days</div>
                                                    </div>
                                                </div>
                                                <div className="motivational-quote">
                                                    {dailyQuote?.quote || "One day at a time, one lighthouse beam at a time."}
                                                </div>
                                                {dailyQuote?.author && (
                                                    <div style={{fontSize: '12px', opacity: 0.7, marginTop: '5px'}}>
                                                        ‚Äî {dailyQuote.author}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        
                                        {dayCounterView === 2 && (
                                            <div className="day-display">
                                                <div className="time-blocks">
                                                    <div className="time-block">
                                                        <div className="time-value">{sobrietyDays}</div>
                                                        <div className="time-label">Total Days</div>
                                                    </div>
                                                </div>
                                                <div className="motivational-quote">
                                                    {dailyQuote?.quote || "One day at a time, one lighthouse beam at a time."}
                                                </div>
                                                {dailyQuote?.author && (
                                                    <div style={{fontSize: '12px', opacity: 0.7, marginTop: '5px'}}>
                                                        ‚Äî {dailyQuote.author}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        
                                        <div className="view-dots">
                                            {[0, 1, 2].map(index => (
                                                <div
                                                    key={index}
                                                    className={`dot ${dayCounterView === index ? 'active' : ''}`}
                                                    onClick={() => setDayCounterView(index)}
                                                />
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                
                                {nextMilestone && (
                                    <div className="milestone-preview">
                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                            <div>
                                                <div style={{fontSize: '18px', color: 'white', fontWeight: 'bold'}}>
                                                    {nextMilestone.icon || 'üéØ'} Next: {nextMilestone.title}
                                                </div>
                                                <div style={{color: 'rgba(255,255,255,0.7)', marginTop: '5px', fontSize: '14px'}}>
                                                    {nextMilestone.description}
                                                </div>
                                            </div>
                                            <div style={{textAlign: 'center'}}>
                                                <div style={{fontSize: '24px', fontWeight: 'bold', color: '#4CAF50'}}>
                                                    {nextMilestone.daysRequired - sobrietyDays}
                                                </div>
                                                <div style={{fontSize: '12px', color: 'rgba(255,255,255,0.7)'}}>
                                                    days to go
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                {nextSession && (
                                    <div className="session-info">
                                        <div className="session-title">üìÖ Next Session</div>
                                        <div className="session-details">
                                            {nextSession.scheduledDate.toLocaleDateString()} at {nextSession.scheduledTime}
                                            <br />
                                            Type: {nextSession.type}
                                            <br />
                                            <small style={{opacity: 0.8}}>Full schedule in Carepatron</small>
                                        </div>
                                    </div>
                                )}
                                
                                <div className="mood-tracker">
                                    <div className="text-center" style={{color: 'white', marginBottom: '15px'}}>
                                        How are you feeling today?
                                    </div>
                                    <div className="mood-options">
                                        {['üòä', 'üòê', 'üòî', 'üò∞', 'üò°'].map(mood => (
                                            <div
                                                key={mood}
                                                className={`mood-emoji ${selectedMood === mood ? 'selected' : ''}`}
                                                onClick={() => handleMoodSelect(mood)}
                                            >
                                                {mood}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="daily-pledge">
                                    <div className="pledge-text">"I commit to my recovery today"</div>
                                    <button 
                                        className={`btn-primary ${pledgeMade ? 'completed' : ''}`}
                                        onClick={handlePledge}
                                        style={{background: pledgeMade ? 'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)' : ''}}
                                    >
                                        {pledgeMade ? '‚úì Pledge Made' : 'Make Today\'s Pledge'}
                                    </button>
                                </div>
                                
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <div className="stat-icon">üí∞</div>
                                        <div className="stat-value">${moneySaved.toLocaleString()}</div>
                                        <div className="stat-label">Money Saved</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-icon">üòä</div>
                                        <div className="stat-value">{avgMoodDisplay}/10</div>
                                        <div className="stat-label">Avg Mood (7d)</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-icon">üìà</div>
                                        <div className="stat-value">{currentStreak}</div>
                                        <div className="stat-label">Check-in Streak</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-icon">‚≠ê</div>
                                        <div className="stat-value">
                                            {nextMilestone ? (nextMilestone.daysRequired - sobrietyDays) : daysUntilMilestone}d
                                        </div>
                                        <div className="stat-label">Next Milestone</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-icon">üìù</div>
                                        <div className="stat-value">{assignmentsCompleted}/{assignments.length}</div>
                                        <div className="stat-label">Tasks Complete</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-icon">‚è∞</div>
                                        <div className="stat-value">{lastCheckInTime}</div>
                                        <div className="stat-label">Last Check-in</div>
                                    </div>
                                </div>
                            </>
                        )}
                        
                        {currentView === 'progress' && (
                            <>
                                <h2 style={{color: 'white', marginBottom: '20px'}}>My Progress</h2>
                                
                                {moodChartData && (
                                    <div className="chart-container">
                                        <canvas id="moodChart"></canvas>
                                    </div>
                                )}
                                
                                {cravingChartData && (
                                    <div className="chart-container">
                                        <canvas id="cravingChart"></canvas>
                                    </div>
                                )}
                                
                                <div className="milestones-container">
                                    <h3 style={{color: '#f4c430', marginBottom: '15px'}}>Recovery Milestones</h3>
                                    {milestones.map(milestone => (
                                        <div 
                                            key={milestone.id} 
                                            className={`milestone-item ${sobrietyDays >= milestone.daysRequired ? 'milestone-achieved' : ''}`}
                                        >
                                            <div className="milestone-icon">
                                                {sobrietyDays >= milestone.daysRequired ? '‚úÖ' : milestone.icon || 'üéØ'}
                                            </div>
                                            <div className="milestone-content">
                                                <div className="milestone-title">{milestone.title}</div>
                                                <div className="milestone-days">
                                                    {milestone.daysRequired} days
                                                    {sobrietyDays < milestone.daysRequired && 
                                                        ` (${milestone.daysRequired - sobrietyDays} to go)`}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="export-section" style={{marginTop: '30px'}}>
                                    <h3 style={{color: '#f4c430', marginBottom: '15px'}}>Export Your Data</h3>
                                    <button className="btn-primary" onClick={exportDataAsJSON} style={{marginBottom: '10px'}}>
                                        üì• Export as JSON
                                    </button>
                                    <button className="btn-primary" onClick={exportDataAsPDF}>
                                        üìÑ Export as PDF
                                    </button>
                                </div>
                            </>
                        )}
                        
                        {currentView === 'tasks' && (
                            <div className="section-content">
                                <h2 style={{color: 'white', marginBottom: '20px'}}>My Recovery Plan</h2>
                                
                                <div className="daily-tasks-card">
                                    <h3 style={{color: '#4CAF50', marginBottom: '15px'}}>üìÖ Daily Tasks</h3>
                                    <div className="task-list">
                                        <div 
                                            className="task-item"
                                            onClick={() => setShowModal('checkIn')}
                                        >
                                            <span>‚òÄÔ∏è Morning Check-in</span>
                                            <span className={checkInStatus.morning ? 'completed' : 'pending'}>
                                                {checkInStatus.morning ? '‚úì' : 'Pending'}
                                            </span>
                                        </div>
                                        <div 
                                            className="task-item"
                                            onClick={() => setShowModal('reflection')}
                                        >
                                            <span>üåô Evening Reflection</span>
                                            <span className={checkInStatus.evening ? 'completed' : 'pending'}>
                                                {checkInStatus.evening ? '‚úì' : 'Pending'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="goals-section">
                                    <h3 style={{color: '#f4c430', marginBottom: '15px'}}>üéØ My Goals</h3>
                                    
                                    {goals.length > 0 ? (
                                        goals.map(goal => (
                                            <div key={goal.id} className="goal-card">
                                                <div className="goal-header">
                                                    <h4 style={{color: 'white'}}>{goal.title}</h4>
                                                    <span className="progress-badge">
                                                        {goal.progress || 0}% Complete
                                                    </span>
                                                </div>
                                                
                                                <p style={{color: 'rgba(255,255,255,0.7)', marginBottom: '15px'}}>
                                                    {goal.description}
                                                </p>
                                                
                                                <div className="progress-bar">
                                                    <div className="progress-fill" style={{
                                                        width: `${goal.progress || 0}%`
                                                    }}></div>
                                                </div>
                                                
                                                {goal.assignments && goal.assignments.length > 0 && (
                                                    <div className="assignments-list">
                                                        <h5 style={{color: '#f4c430', marginBottom: '10px'}}>Tasks:</h5>
                                                        {goal.assignments.map(assignment => (
                                                            <div key={assignment.id} className="assignment-item">
                                                                <div>
                                                                    <span style={{
                                                                        textDecoration: assignment.status === 'completed' ? 'line-through' : 'none',
                                                                        color: assignment.status === 'completed' ? 'rgba(255,255,255,0.5)' : 'white'
                                                                    }}>
                                                                        {assignment.title}
                                                                    </span>
                                                                    {assignment.dueDate && (
                                                                        <small style={{
                                                                            display: 'block',
                                                                            color: 'rgba(255,255,255,0.5)',
                                                                            marginTop: '5px'
                                                                        }}>
                                                                            Due: {new Date(assignment.dueDate).toLocaleDateString()}
                                                                        </small>
                                                                    )}
                                                                </div>
                                                                {assignment.status !== 'completed' && (
                                                                    <button 
                                                                        className="btn-complete"
                                                                        onClick={() => completeAssignment(assignment.id, goal.id)}
                                                                    >
                                                                        Complete
                                                                    </button>
                                                                )}
                                                                {assignment.status === 'completed' && (
                                                                    <span style={{color: '#4CAF50'}}>‚úì</span>
                                                                )}
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        ))
                                    ) : (
                                        <div className="empty-state">
                                            <div className="empty-state-icon">üéØ</div>
                                            <div className="empty-state-text">
                                                No active goals yet. Your coach will assign goals to help guide your recovery journey.
                                            </div>
                                        </div>
                                    )}
                                </div>
                                
                                {assignments.length > 0 && (
                                    <div className="assignments-section">
                                        <h3 style={{color: '#f4c430', marginBottom: '15px'}}>üìù Assignments</h3>
                                        {assignments.map(assignment => (
                                            <div key={assignment.id} className="assignment-card">
                                                <h4>{assignment.title}</h4>
                                                <p style={{color: 'rgba(255,255,255,0.7)'}}>
                                                    {assignment.description}
                                                </p>
                                                {assignment.dueDate && (
                                                    <small>Due: {new Date(assignment.dueDate).toLocaleDateString()}</small>
                                                )}
                                                {assignment.status !== 'completed' && (
                                                    <button 
                                                        onClick={() => completeAssignment(assignment.id)}
                                                        className="btn-complete"
                                                    >
                                                        Mark Complete
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {currentView === 'connect' && (
                            <div className="section-content">
                                <h2 style={{color: 'white', marginBottom: '20px'}}>Community Connect</h2>
                                
                                <div className="chat-tabs">
                                    <button 
                                        className={`tab-btn ${activeChat === 'main' ? 'active' : ''}`}
                                        onClick={() => setActiveChat('main')}
                                    >
                                        GLRS Community
                                    </button>
                                    <button 
                                        className={`tab-btn ${activeChat === 'rooms' ? 'active' : ''}`}
                                        onClick={() => setActiveChat('rooms')}
                                    >
                                        Topic Rooms
                                    </button>
                                    <button 
                                        className={`tab-btn ${activeChat === 'groups' ? 'active' : ''}`}
                                        onClick={() => setActiveChat('groups')}
                                    >
                                        Support Groups
                                    </button>
                                </div>

                                {activeChat === 'main' && (
                                    <div>
                                        <GroupChat 
                                            groupId="main"
                                            groupMessages={communityMessages}
                                            onSendMessage={sendCommunityMessage}
                                            currentUserId={user.uid}
                                        />
                                    </div>
                                )}

                                {activeChat === 'rooms' && (
                                    <>
                                        <h3 style={{color: '#f4c430', marginBottom: '20px'}}>Recovery Topic Rooms</h3>
                                        {topicRooms.length > 0 ? (
                                            <div className="topic-rooms">
                                                {topicRooms.map(room => (
                                                    <div 
                                                        key={room.id} 
                                                        className="topic-room"
                                                        onClick={() => {
                                                            setActiveTopicRoom(room.id);
                                                            loadGroupMessages(room.id);
                                                            setShowModal('topicRoom');
                                                        }}
                                                        style={{
                                                            background: 'linear-gradient(135deg, rgba(244, 196, 48, 0.1) 0%, rgba(255, 149, 0, 0.1) 100%)',
                                                            border: '1px solid rgba(244, 196, 48, 0.3)',
                                                            borderRadius: '15px',
                                                            padding: '20px',
                                                            marginBottom: '15px',
                                                            cursor: 'pointer'
                                                        }}
                                                    >
                                                        <div className="topic-room-header">
                                                            <div style={{fontSize: '24px', marginBottom: '5px'}}>{room.icon || 'üí¨'}</div>
                                                            <div className="topic-room-title">{room.name}</div>
                                                        </div>
                                                        <div className="topic-room-description">{room.description}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="empty-state">
                                                <div className="empty-state-icon">üí¨</div>
                                                <div className="empty-state-text">
                                                    No topic rooms available yet. Check back soon.
                                                </div>
                                            </div>
                                        )}
                                    </>
                                )}

                                {activeChat === 'groups' && (
                                    <>
                                        <h3 style={{color: '#f4c430', marginBottom: '20px'}}>Support Group Meetings</h3>
                                        {meetings.length > 0 ? (
                                            <div className="support-groups">
                                                {meetings.map(meeting => (
                                                    <div key={meeting.id} className="meeting-card">
                                                        <div className="meeting-type">{meeting.type}</div>
                                                        <div className="meeting-title">{meeting.name}</div>
                                                        <div className="meeting-details">
                                                            <div>üìÖ {meeting.schedule}</div>
                                                            <div>‚è∞ {meeting.time}</div>
                                                            <div>üìç {meeting.location || 'Online'}</div>
                                                        </div>
                                                        {meeting.meetingUrl && (
                                                            <button 
                                                                className="join-btn" 
                                                                onClick={() => window.open(meeting.meetingUrl, '_blank')}
                                                            >
                                                                Join Online Meeting
                                                            </button>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="empty-state">
                                                <div className="empty-state-icon">üë•</div>
                                                <div className="empty-state-text">
                                                    No support groups currently scheduled. Check back soon.
                                                </div>
                                            </div>
                                        )}
                                    </>
                                )}
                                
                                <div className="crisis-resources">
                                    <div className="crisis-title">üÜò Crisis Resources</div>
                                    {emergencyResources.length > 0 ? (
                                        emergencyResources.map(resource => (
                                            <div key={resource.id} style={{marginBottom: '15px'}}>
                                                <div className="crisis-number">
                                                    {resource.phone && (
                                                        <a href={`tel:${resource.phone}`}>
                                                            {resource.phone}
                                                        </a>
                                                    )}
                                                </div>
                                                <div className="crisis-description">{resource.title}</div>
                                                <small style={{opacity: 0.7}}>{resource.available}</small>
                                            </div>
                                        ))
                                    ) : (
                                        <>
                                            <div style={{marginBottom: '15px'}}>
                                                <div className="crisis-number">
                                                    <a href="tel:988">988</a>
                                                </div>
                                                <div className="crisis-description">Suicide & Crisis Lifeline</div>
                                            </div>
                                            <div>
                                                <div className="crisis-number">
                                                    <a href="tel:1-800-662-4357">1-800-662-HELP</a>
                                                </div>
                                                <div className="crisis-description">SAMHSA National Helpline</div>
                                            </div>
                                        </>
                                    )}
                                    <button className="sos-btn" onClick={triggerSOS}>
                                        üö® SOS - I Need Help Now
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'profile' && (
                            <ProfileView 
                                user={userData || user}
                                profileImage={profileImage}
                                resources={resources}
                                onShowModal={setShowModal}
                                onLogout={handleLogout}
                                onImageUpload={handleProfileImageUpload}
                                fileInputRef={fileInputRef}
                            />
                        )}
                    </div>
                    
                    <div className="bottom-nav">
                        <div 
                            className={`nav-item ${currentView === 'home' ? 'active' : ''}`}
                            onClick={() => setCurrentView('home')}
                        >
                            <div className="nav-icon">üè†</div>
                            <div className="nav-label">Home</div>
                        </div>
                        <div 
                            className={`nav-item ${currentView === 'progress' ? 'active' : ''}`}
                            onClick={() => setCurrentView('progress')}
                        >
                            <div className="nav-icon">üìà</div>
                            <div className="nav-label">Progress</div>
                        </div>
                        <div 
                            className={`nav-item ${currentView === 'tasks' ? 'active' : ''}`}
                            onClick={() => setCurrentView('tasks')}
                        >
                            <div className="nav-icon">‚úÖ</div>
                            <div className="nav-label">Tasks</div>
                        </div>
                        <div 
                            className={`nav-item ${currentView === 'connect' ? 'active' : ''}`}
                            onClick={() => setCurrentView('connect')}
                        >
                            <div className="nav-icon">üí¨</div>
                            <div className="nav-label">Connect</div>
                        </div>
                        <div 
                            className={`nav-item ${currentView === 'profile' ? 'active' : ''}`}
                            onClick={() => setCurrentView('profile')}
                        >
                            <div className="nav-icon">üë§</div>
                            <div className="nav-label">Profile</div>
                        </div>
                    </div>
                    
                    {showModal && (
                        <ModalContainer 
                            type={showModal}
                            onClose={() => setShowModal(null)}
                            data={{
                                notifications,
                                userData,
                                activeTopicRoom,
                                groupMessages
                            }}
                            handlers={{
                                markNotificationAsRead,
                                markAllNotificationsAsRead,
                                handleMorningCheckIn,
                                handleEveningReflection,
                                sendGroupMessage,
                                exportDataAsJSON,
                                exportDataAsPDF
                            }}
                        />
                    )}
                </div>
            );
        }
        
        // Profile View Component with Resources from Admin
        function ProfileView({ user, profileImage, resources, onShowModal, onLogout, onImageUpload, fileInputRef }) {
            const handleImageSelect = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Image must be less than 5MB');
                        return;
                    }
                    onImageUpload(file);
                }
            };
            
            return (
                <>
                    <div className="profile-menu">
                        <div className="profile-header">
                            <div className="profile-avatar" onClick={() => fileInputRef.current?.click()}>
                                {profileImage ? (
                                    <img src={profileImage} alt="Profile" />
                                ) : (
                                    (user.displayName || user.email || 'üë§').charAt(0).toUpperCase()
                                )}
                                <div className="profile-avatar-upload">
                                    üì∑
                                </div>
                            </div>
                            <input 
                                ref={fileInputRef}
                                type="file"
                                accept="image/*"
                                className="upload-input"
                                onChange={handleImageSelect}
                            />
                            <div className="profile-name">{user.firstName && user.lastName ? `${user.firstName} ${user.lastName}` : user.displayName || 'User'}</div>
                            <div className="profile-email">{user.email}</div>
                        </div>
                        
                        <div className="menu-section">
                            <div className="menu-title">Account</div>
                            <button className="menu-item" onClick={() => onShowModal('account')}>
                                <div className="menu-item-left">
                                    <span className="menu-icon">üë§</span>
                                    <span>Account Settings</span>
                                </div>
                                <span className="menu-arrow">‚Ä∫</span>
                            </button>
                            <button className="menu-item" onClick={() => onShowModal('password')}>
                                <div className="menu-item-left">
                                    <span className="menu-icon">üîí</span>
                                    <span>Change Password</span>
                                </div>
                                <span className="menu-arrow">‚Ä∫</span>
                            </button>
                            <button className="menu-item" onClick={() => onShowModal('notifications')}>
                                <div className="menu-item-left">
                                    <span className="menu-icon">üîî</span>
                                    <span>Notifications</span>
                                </div>
                                <span className="menu-arrow">‚Ä∫</span>
                            </button>
                            <button className="menu-item" onClick={() => onShowModal('emergency')}>
                                <div className="menu-item-left">
                                    <span className="menu-icon">üÜò</span>
                                    <span>Emergency Contacts</span>
                                </div>
                                <span className="menu-arrow">‚Ä∫</span>
                            </button>
                        </div>
                        
                        {/* Recovery Resources from Admin */}
                        <div className="menu-section">
                            <div className="menu-title">Recovery Resources</div>
                            
                            {/* Videos */}
                            {resources?.videos?.length > 0 && (
                                <div style={{marginBottom: '10px'}}>
                                    <div style={{fontSize: '12px', opacity: 0.7, marginLeft: '15px', marginBottom: '5px'}}>
                                        üé• Videos ({resources.videos.length})
                                    </div>
                                    {resources.videos.slice(0, 3).map(video => (
                                        <a 
                                            key={video.id}
                                            href={video.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="menu-item"
                                            style={{textDecoration: 'none'}}
                                        >
                                            <div className="menu-item-left">
                                                <span className="menu-icon">
                                                    {video.featured ? '‚≠ê' : 'üé¨'}
                                                </span>
                                                <div>
                                                    <div>{video.title}</div>
                                                    <div style={{fontSize: '12px', opacity: 0.7}}>
                                                        {video.description?.substring(0, 50)}...
                                                    </div>
                                                </div>
                                            </div>
                                            <span className="menu-arrow">‚Ä∫</span>
                                        </a>
                                    ))}
                                </div>
                            )}
                            
                            {/* Articles */}
                            {resources?.articles?.length > 0 && (
                                <div style={{marginBottom: '10px'}}>
                                    <div style={{fontSize: '12px', opacity: 0.7, marginLeft: '15px', marginBottom: '5px'}}>
                                        üìÑ Articles ({resources.articles.length})
                                    </div>
                                    {resources.articles.slice(0, 3).map(article => (
                                        <a 
                                            key={article.id}
                                            href={article.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="menu-item"
                                            style={{textDecoration: 'none'}}
                                        >
                                            <div className="menu-item-left">
                                                <span className="menu-icon">
                                                    {article.featured ? '‚≠ê' : 'üìñ'}
                                                </span>
                                                <div>
                                                    <div>{article.title}</div>
                                                    <div style={{fontSize: '12px', opacity: 0.7}}>
                                                        {article.description?.substring(0, 50)}...
                                                    </div>
                                                </div>
                                            </div>
                                            <span className="menu-arrow">‚Ä∫</span>
                                        </a>
                                    ))}
                                </div>
                            )}
                            
                            {/* Tools */}
                            {resources?.tools?.length > 0 && (
                                <div style={{marginBottom: '10px'}}>
                                    <div style={{fontSize: '12px', opacity: 0.7, marginLeft: '15px', marginBottom: '5px'}}>
                                        üõ†Ô∏è Tools ({resources.tools.length})
                                    </div>
                                    {resources.tools.slice(0, 3).map(tool => (
                                        <a 
                                            key={tool.id}
                                            href={tool.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="menu-item"
                                            style={{textDecoration: 'none'}}
                                        >
                                            <div className="menu-item-left">
                                                <span className="menu-icon">
                                                    {tool.featured ? '‚≠ê' : 'üîß'}
                                                </span>
                                                <div>
                                                    <div>{tool.title}</div>
                                                    <div style={{fontSize: '12px', opacity: 0.7}}>
                                                        {tool.description?.substring(0, 50)}...
                                                    </div>
                                                </div>
                                            </div>
                                            <span className="menu-arrow">‚Ä∫</span>
                                        </a>
                                    ))}
                                </div>
                            )}
                            
                            {/* Worksheets */}
                            {resources?.worksheets?.length > 0 && (
                                <div style={{marginBottom: '10px'}}>
                                    <div style={{fontSize: '12px', opacity: 0.7, marginLeft: '15px', marginBottom: '5px'}}>
                                        üìù Worksheets ({resources.worksheets.length})
                                    </div>
                                    {resources.worksheets.slice(0, 3).map(worksheet => (
                                        <a 
                                            key={worksheet.id}
                                            href={worksheet.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="menu-item"
                                            style={{textDecoration: 'none'}}
                                        >
                                            <div className="menu-item-left">
                                                <span className="menu-icon">
                                                    {worksheet.featured ? '‚≠ê' : '‚úèÔ∏è'}
                                                </span>
                                                <div>
                                                    <div>{worksheet.title}</div>
                                                    <div style={{fontSize: '12px', opacity: 0.7}}>
                                                        {worksheet.description?.substring(0, 50)}...
                                                    </div>
                                                </div>
                                            </div>
                                            <span className="menu-arrow">‚Ä∫</span>
                                        </a>
                                    ))}
                                </div>
                            )}
                            
                            {/* Show all resources button if there are many */}
                            {(resources?.videos?.length > 3 || resources?.articles?.length > 3 || 
                              resources?.tools?.length > 3 || resources?.worksheets?.length > 3) && (
                                <button className="menu-item" onClick={() => onShowModal('allResources')}>
                                    <div className="menu-item-left">
                                        <span className="menu-icon">üìö</span>
                                        <span>View All Resources</span>
                                    </div>
                                    <span className="menu-arrow">‚Ä∫</span>
                                </button>
                            )}
                            
                            {/* Empty state */}
                            {(!resources?.videos?.length && !resources?.articles?.length && 
                              !resources?.tools?.length && !resources?.worksheets?.length) && (
                                <div style={{padding: '15px', textAlign: 'center', opacity: 0.6}}>
                                    No resources available yet
                                </div>
                            )}
                        </div>
                        
                        <div className="menu-section">
                            <div className="menu-title">Support</div>
                            <button className="menu-item" onClick={() => onShowModal('export')}>
                                <div className="menu-item-left">
                                    <span className="menu-icon">üì•</span>
                                    <span>Export My Data</span>
                                </div>
                                <span className="menu-arrow">‚Ä∫</span>
                            </button>
                            <button className="menu-item" onClick={() => onShowModal('feedback')}>
                                <div className="menu-item-left">
                                    <span className="menu-icon">üí¨</span>
                                    <span>Send Feedback</span>
                                </div>
                                <span className="menu-arrow">‚Ä∫</span>
                            </button>
                        </div>
                        
                        <div className="menu-section">
                            <button className="btn-danger" onClick={onLogout}>
                                Sign Out
                            </button>
                        </div>
                    </div>
                </>
            );
        }
        
        // Group Chat Component
        function GroupChat({ groupId, groupMessages, onSendMessage, currentUserId }) {
            const [message, setMessage] = useState('');
            const messagesEndRef = useRef(null);
            
            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [groupMessages]);
            
            const handleSend = () => {
                if (message.trim()) {
                    onSendMessage(message);
                    setMessage('');
                }
            };
            
            return (
                <div className="group-chat-container">
                    <div className="group-info">
                        <div className="group-icon">üè†</div>
                        <div className="group-name">GLRS Community</div>
                        <div className="group-description">A safe space for recovery support</div>
                    </div>
                    
                    <div className="group-messages">
                        {groupMessages.length > 0 ? (
                            groupMessages.map(msg => (
                                <div key={msg.id} className="group-message">
                                    {msg.userId !== currentUserId && (
                                        <div className="message-sender">{msg.senderName || 'Anonymous'}</div>
                                    )}
                                    <div className="message-bubble" style={{
                                        marginLeft: msg.userId === currentUserId ? 'auto' : '0',
                                        background: msg.userId === currentUserId ? 
                                            'rgba(244, 196, 48, 0.2)' : 'rgba(255, 255, 255, 0.1)'
                                    }}>
                                        {msg.content}
                                    </div>
                                    <div className="message-timestamp" style={{
                                        textAlign: msg.userId === currentUserId ? 'right' : 'left'
                                    }}>
                                        {msg.createdAt ? new Date(msg.createdAt).toLocaleTimeString() : 'now'}
                                    </div>
                                </div>
                            ))
                        ) : (
                            <div style={{textAlign: 'center', opacity: 0.6, padding: '40px'}}>
                                No messages yet. Start the conversation!
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>
                    
                    <div className="chat-input-group">
                        <input
                            type="text"
                            className="chat-input"
                            placeholder="Type your message..."
                            value={message}
                            onChange={(e) => setMessage(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                        />
                        <button className="send-btn" onClick={handleSend}>
                            Send
                        </button>
                    </div>
                </div>
            );
        }
        
        // Modal Container Component
        function ModalContainer({ type, onClose, data, handlers }) {
            const [formData, setFormData] = useState({});
            const [morningData, setMorningData] = useState({
                mood: 3,
                craving: 1,
                sleepQuality: 3,
                anxietyLevel: 2,
                notes: ''
            });
            const [eveningData, setEveningData] = useState({
                gratitude: '',
                challenges: '',
                tomorrowGoal: '',
                overallDay: 3
            });
            
            const renderModalContent = () => {
                switch(type) {
                    case 'notifications':
                        return (
                            <div className="notification-panel">
                                <h3 style={{marginBottom: '20px'}}>Notifications</h3>
                                {data.notifications.length > 0 ? (
                                    <>
                                        {data.notifications.map(notification => (
                                            <div 
                                                key={notification.id}
                                                className={`notification-item ${!notification.read ? 'unread' : ''}`}
                                                onClick={() => handlers.markNotificationAsRead(notification.id)}
                                            >
                                                <div className="notification-header">
                                                    <span className="notification-type">{notification.type}</span>
                                                    <span className="notification-time">
                                                        {new Date(notification.createdAt?.toDate ? 
                                                            notification.createdAt.toDate() : 
                                                            notification.createdAt).toLocaleTimeString()}
                                                    </span>
                                                </div>
                                                <div className="notification-message">
                                                    <strong>{notification.title}</strong>
                                                    <div>{notification.message}</div>
                                                </div>
                                            </div>
                                        ))}
                                        {data.notifications.some(n => !n.read) && (
                                            <div className="notification-actions">
                                                <button 
                                                    className="mark-all-read"
                                                    onClick={handlers.markAllNotificationsAsRead}
                                                >
                                                    Mark All as Read
                                                </button>
                                            </div>
                                        )}
                                    </>
                                ) : (
                                    <div style={{textAlign: 'center', opacity: 0.6, padding: '40px'}}>
                                        No notifications
                                    </div>
                                )}
                            </div>
                        );
                        
                    case 'checkIn':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>Morning Check-in</h3>
                                <div className="slider-group">
                                    <div className="slider-label">
                                        <span>Overall Mood</span>
                                        <span className="slider-value">{morningData.mood}</span>
                                    </div>
                                    <input 
                                        type="range"
                                        className="slider"
                                        min="1" max="5"
                                        value={morningData.mood}
                                        onChange={(e) => setMorningData({...morningData, mood: parseInt(e.target.value)})}
                                    />
                                </div>
                                
                                <div className="slider-group">
                                    <div className="slider-label">
                                        <span>Craving Intensity</span>
                                        <span className="slider-value">{morningData.craving}</span>
                                    </div>
                                    <input 
                                        type="range"
                                        className="slider"
                                        min="1" max="5"
                                        value={morningData.craving}
                                        onChange={(e) => setMorningData({...morningData, craving: parseInt(e.target.value)})}
                                    />
                                </div>
                                
                                <div className="slider-group">
                                    <div className="slider-label">
                                        <span>Sleep Quality</span>
                                        <span className="slider-value">{morningData.sleepQuality}</span>
                                    </div>
                                    <input 
                                        type="range"
                                        className="slider"
                                        min="1" max="5"
                                        value={morningData.sleepQuality}
                                        onChange={(e) => setMorningData({...morningData, sleepQuality: parseInt(e.target.value)})}
                                    />
                                </div>
                                
                                <div className="slider-group">
                                    <div className="slider-label">
                                        <span>Anxiety Level</span>
                                        <span className="slider-value">{morningData.anxietyLevel}</span>
                                    </div>
                                    <input 
                                        type="range"
                                        className="slider"
                                        min="1" max="5"
                                        value={morningData.anxietyLevel}
                                        onChange={(e) => setMorningData({...morningData, anxietyLevel: parseInt(e.target.value)})}
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Notes (Optional)</label>
                                    <textarea 
                                        className="textarea"
                                        placeholder="Any thoughts or feelings you'd like to share?"
                                        value={morningData.notes}
                                        onChange={(e) => setMorningData({...morningData, notes: e.target.value})}
                                    />
                                </div>
                                
                                <button 
                                    className="btn-primary"
                                    onClick={() => {
                                        handlers.handleMorningCheckIn(morningData);
                                        onClose();
                                    }}
                                >
                                    Submit Check-in
                                </button>
                            </div>
                        );
                        
                    case 'reflection':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>Evening Reflection</h3>
                                <div className="form-group">
                                    <label className="form-label">What are you grateful for today?</label>
                                    <textarea 
                                        className="textarea"
                                        placeholder="List 3 things you're grateful for..."
                                        value={eveningData.gratitude}
                                        onChange={(e) => setEveningData({...eveningData, gratitude: e.target.value})}
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">What challenges did you face?</label>
                                    <textarea 
                                        className="textarea"
                                        placeholder="Describe any difficulties you encountered..."
                                        value={eveningData.challenges}
                                        onChange={(e) => setEveningData({...eveningData, challenges: e.target.value})}
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">What's one goal for tomorrow?</label>
                                    <textarea 
                                        className="textarea"
                                        placeholder="Set an intention for tomorrow..."
                                        value={eveningData.tomorrowGoal}
                                        onChange={(e) => setEveningData({...eveningData, tomorrowGoal: e.target.value})}
                                    />
                                </div>
                                
                                <div className="slider-group">
                                    <div className="slider-label">
                                        <span>Overall Day Rating</span>
                                        <span className="slider-value">{eveningData.overallDay}</span>
                                    </div>
                                    <input 
                                        type="range"
                                        className="slider"
                                        min="1" max="5"
                                        value={eveningData.overallDay}
                                        onChange={(e) => setEveningData({...eveningData, overallDay: parseInt(e.target.value)})}
                                    />
                                </div>
                                
                                <button 
                                    className="btn-primary"
                                    onClick={() => {
                                        handlers.handleEveningReflection(eveningData);
                                        onClose();
                                    }}
                                >
                                    Submit Reflection
                                </button>
                            </div>
                        );
                        
                    case 'topicRoom':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>
                                    {data.activeTopicRoom?.icon} {data.activeTopicRoom?.name}
                                </h3>
                                <GroupChat 
                                    groupId={data.activeTopicRoom?.id}
                                    groupMessages={data.groupMessages}
                                    onSendMessage={(content) => handlers.sendGroupMessage(data.activeTopicRoom?.id, content)}
                                    currentUserId={data.userData?.id}
                                />
                            </div>
                        );
                        
                    case 'export':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>Export Your Data</h3>
                                <div className="export-options">
                                    <div className="export-option" onClick={() => {
                                        handlers.exportDataAsJSON();
                                        onClose();
                                    }}>
                                        <div className="export-title">üì• Export as JSON</div>
                                        <div className="export-description">
                                            Download all your data in JSON format for backup or analysis
                                        </div>
                                    </div>
                                    <div className="export-option" onClick={() => {
                                        handlers.exportDataAsPDF();
                                        onClose();
                                    }}>
                                        <div className="export-title">üìÑ Export as PDF</div>
                                        <div className="export-description">
                                            Generate a progress report in PDF format
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    case 'account':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>Account Settings</h3>
                                <div className="form-group">
                                    <label className="form-label">First Name</label>
                                    <input 
                                        type="text"
                                        className="form-input"
                                        value={formData.firstName || data.userData?.firstName || ''}
                                        onChange={(e) => setFormData({...formData, firstName: e.target.value})}
                                        placeholder="Enter first name"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Last Name</label>
                                    <input 
                                        type="text"
                                        className="form-input"
                                        value={formData.lastName || data.userData?.lastName || ''}
                                        onChange={(e) => setFormData({...formData, lastName: e.target.value})}
                                        placeholder="Enter last name"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Phone</label>
                                    <input 
                                        type="tel"
                                        className="form-input"
                                        value={formData.phone || data.userData?.phone || ''}
                                        onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                        placeholder="Enter phone number"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Sobriety Date</label>
                                    <input 
                                        type="date"
                                        className="form-input"
                                        value={formData.sobrietyDate || (data.userData?.sobrietyDate ? new Date(data.userData.sobrietyDate).toISOString().split('T')[0] : '')}
                                        onChange={(e) => setFormData({...formData, sobrietyDate: e.target.value})}
                                    />
                                </div>
                                <button 
                                    className="btn-primary"
                                    onClick={async () => {
                                        try {
                                            await db.collection('users').doc(data.userData.id).update(formData);
                                            alert('Account settings updated');
                                            onClose();
                                        } catch (error) {
                                            alert('Failed to update settings');
                                        }
                                    }}
                                >
                                    Save Changes
                                </button>
                            </div>
                        );
                        
                    case 'password':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>Change Password</h3>
                                <div className="form-group">
                                    <label className="form-label">Current Password</label>
                                    <input 
                                        type="password"
                                        className="form-input"
                                        value={formData.currentPassword || ''}
                                        onChange={(e) => setFormData({...formData, currentPassword: e.target.value})}
                                        placeholder="Enter current password"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">New Password</label>
                                    <input 
                                        type="password"
                                        className="form-input"
                                        value={formData.newPassword || ''}
                                        onChange={(e) => setFormData({...formData, newPassword: e.target.value})}
                                        placeholder="Enter new password"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Confirm New Password</label>
                                    <input 
                                        type="password"
                                        className="form-input"
                                        value={formData.confirmPassword || ''}
                                        onChange={(e) => setFormData({...formData, confirmPassword: e.target.value})}
                                        placeholder="Confirm new password"
                                    />
                                </div>
                                <button 
                                    className="btn-primary"
                                    onClick={async () => {
                                        if (formData.newPassword !== formData.confirmPassword) {
                                            alert('Passwords do not match');
                                            return;
                                        }
                                        try {
                                            const user = auth.currentUser;
                                            const credential = firebase.auth.EmailAuthProvider.credential(
                                                user.email,
                                                formData.currentPassword
                                            );
                                            await user.reauthenticateWithCredential(credential);
                                            await user.updatePassword(formData.newPassword);
                                            alert('Password updated successfully');
                                            onClose();
                                        } catch (error) {
                                            alert('Failed to update password: ' + error.message);
                                        }
                                    }}
                                >
                                    Update Password
                                </button>
                            </div>
                        );
                        
                    case 'emergency':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>Emergency Contacts</h3>
                                <div className="emergency-contacts-list">
                                    {data.userData?.emergencyContacts?.map((contact, index) => (
                                        <div key={index} className="contact-item">
                                            <div className="contact-name">{contact.name}</div>
                                            <div className="contact-phone">{contact.phone}</div>
                                            <div className="contact-relationship">{contact.relationship}</div>
                                        </div>
                                    ))}
                                </div>
                                <div className="add-contact-form">
                                    <h4>Add New Contact</h4>
                                    <div className="form-group">
                                        <input 
                                            type="text"
                                            className="form-input"
                                            placeholder="Name"
                                            value={formData.contactName || ''}
                                            onChange={(e) => setFormData({...formData, contactName: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <input 
                                            type="tel"
                                            className="form-input"
                                            placeholder="Phone"
                                            value={formData.contactPhone || ''}
                                            onChange={(e) => setFormData({...formData, contactPhone: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <input 
                                            type="text"
                                            className="form-input"
                                            placeholder="Relationship"
                                            value={formData.contactRelationship || ''}
                                            onChange={(e) => setFormData({...formData, contactRelationship: e.target.value})}
                                        />
                                    </div>
                                    <button 
                                        className="btn-primary"
                                        onClick={async () => {
                                            const newContact = {
                                                name: formData.contactName,
                                                phone: formData.contactPhone,
                                                relationship: formData.contactRelationship
                                            };
                                            const contacts = data.userData?.emergencyContacts || [];
                                            contacts.push(newContact);
                                            try {
                                                await db.collection('users').doc(data.userData.id).update({
                                                    emergencyContacts: contacts
                                                });
                                                alert('Emergency contact added');
                                                onClose();
                                            } catch (error) {
                                                alert('Failed to add contact');
                                            }
                                        }}
                                    >
                                        Add Contact
                                    </button>
                                </div>
                            </div>
                        );
                        
                    case 'notifications':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>Notification Settings</h3>
                                <div className="settings-section">
                                    <div className="settings-title">Daily Reminders</div>
                                    <div className="settings-item">
                                        <div className="settings-label">Morning Check-in</div>
                                        <input 
                                            type="time"
                                            className="time-input"
                                            value={formData.morningTime || '09:00'}
                                            onChange={(e) => setFormData({...formData, morningTime: e.target.value})}
                                        />
                                    </div>
                                    <div className="settings-item">
                                        <div className="settings-label">Evening Reflection</div>
                                        <input 
                                            type="time"
                                            className="time-input"
                                            value={formData.eveningTime || '20:00'}
                                            onChange={(e) => setFormData({...formData, eveningTime: e.target.value})}
                                        />
                                    </div>
                                    <div className="settings-item">
                                        <div className="settings-label">Daily Pledge</div>
                                        <input 
                                            type="time"
                                            className="time-input"
                                            value={formData.pledgeTime || '08:00'}
                                            onChange={(e) => setFormData({...formData, pledgeTime: e.target.value})}
                                        />
                                    </div>
                                </div>
                                <button 
                                    className="btn-primary"
                                    onClick={async () => {
                                        try {
                                            await db.collection('users').doc(data.userData.id).update({
                                                notifications: {
                                                    morningCheckIn: formData.morningTime,
                                                    eveningReflection: formData.eveningTime,
                                                    dailyPledge: formData.pledgeTime
                                                }
                                            });
                                            alert('Notification settings updated');
                                            onClose();
                                        } catch (error) {
                                            alert('Failed to update settings');
                                        }
                                    }}
                                >
                                    Save Settings
                                </button>
                            </div>
                        );
                        
                    case 'feedback':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>Send Feedback</h3>
                                <div className="form-group">
                                    <label className="form-label">Feedback Type</label>
                                    <select 
                                        className="form-input"
                                        value={formData.feedbackType || 'general'}
                                        onChange={(e) => setFormData({...formData, feedbackType: e.target.value})}
                                    >
                                        <option value="general">General Feedback</option>
                                        <option value="bug">Bug Report</option>
                                        <option value="feature">Feature Request</option>
                                        <option value="compliment">Compliment</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Your Feedback</label>
                                    <textarea 
                                        className="textarea"
                                        placeholder="Share your thoughts..."
                                        value={formData.feedbackText || ''}
                                        onChange={(e) => setFormData({...formData, feedbackText: e.target.value})}
                                        rows="6"
                                    />
                                </div>
                                <button 
                                    className="btn-primary"
                                    onClick={async () => {
                                        try {
                                            await db.collection('feedback').add({
                                                userId: data.userData.id,
                                                type: formData.feedbackType,
                                                message: formData.feedbackText,
                                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                                status: 'new'
                                            });
                                            alert('Thank you for your feedback!');
                                            onClose();
                                        } catch (error) {
                                            alert('Failed to send feedback');
                                        }
                                    }}
                                >
                                    Send Feedback
                                </button>
                            </div>
                        );
                        
                    case 'allResources':
                        return (
                            <div>
                                <h3 style={{marginBottom: '20px'}}>All Recovery Resources</h3>
                                {data.resources?.videos?.length > 0 && (
                                    <div className="resource-section">
                                        <h4>Videos</h4>
                                        {data.resources.videos.map(video => (
                                            <div key={video.id} className="resource-item" style={{marginBottom: '10px'}}>
                                                <a href={video.url} target="_blank" rel="noopener noreferrer">
                                                    {video.featured && '‚≠ê '}{video.title}
                                                </a>
                                                <p style={{fontSize: '14px', opacity: 0.8}}>{video.description}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                {data.resources?.articles?.length > 0 && (
                                    <div className="resource-section">
                                        <h4>Articles</h4>
                                        {data.resources.articles.map(article => (
                                            <div key={article.id} className="resource-item" style={{marginBottom: '10px'}}>
                                                <a href={article.url} target="_blank" rel="noopener noreferrer">
                                                    {article.featured && '‚≠ê '}{article.title}
                                                </a>
                                                <p style={{fontSize: '14px', opacity: 0.8}}>{article.description}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                {data.resources?.tools?.length > 0 && (
                                    <div className="resource-section">
                                        <h4>Tools</h4>
                                        {data.resources.tools.map(tool => (
                                            <div key={tool.id} className="resource-item" style={{marginBottom: '10px'}}>
                                                <a href={tool.url} target="_blank" rel="noopener noreferrer">
                                                    {tool.featured && '‚≠ê '}{tool.title}
                                                </a>
                                                <p style={{fontSize: '14px', opacity: 0.8}}>{tool.description}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                {data.resources?.worksheets?.length > 0 && (
                                    <div className="resource-section">
                                        <h4>Worksheets</h4>
                                        {data.resources.worksheets.map(worksheet => (
                                            <div key={worksheet.id} className="resource-item" style={{marginBottom: '10px'}}>
                                                <a href={worksheet.url} target="_blank" rel="noopener noreferrer">
                                                    {worksheet.featured && '‚≠ê '}{worksheet.title}
                                                </a>
                                                <p style={{fontSize: '14px', opacity: 0.8}}>{worksheet.description}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        );
                        
                    default:
                        return <div>Content not available</div>;
                }
            };
            
            return (
                <div className="modal-overlay">
                    <div className="modal-content">
                        <div className="modal-header">
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <div className="modal-body">
                            {renderModalContent()}
                        </div>
                    </div>
                </div>
            );
        }
        
      
        
        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
